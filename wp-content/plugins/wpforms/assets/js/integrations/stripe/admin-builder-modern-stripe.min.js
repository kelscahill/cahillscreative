var WPFormsStripeModernBuilder=window.WPFormsStripeModernBuilder||((e,r)=>{let i={},a={init(){r(a.ready)},ready(){var e,t,n;a.customMetadataActions(),a.isLegacySettings()||(i={$alert:r("#wpforms-stripe-credit-card-alert"),$panelContent:r("#wpforms-panel-content-section-payment-stripe"),$feeNotice:r(".wpforms-stripe-notice-info")},a.bindUIActions(),a.bindPlanUIActions(),wpforms_builder_stripe.is_pro)||(n=(e=".wpforms-panel-content-section-stripe")+" .wpforms-panel-content-section-payment-plan-name input",r(t=e+" .wpforms-panel-content-section-payment-toggle input").each(WPFormsBuilderPaymentsUtils.toggleContent),r(n).each(WPFormsBuilderPaymentsUtils.checkPlanName),r("#wpforms-panel-payments").on("click",t,WPFormsBuilderPaymentsUtils.toggleContent).on("click",e+" .wpforms-panel-content-section-payment-plan-head-buttons-toggle",WPFormsBuilderPaymentsUtils.togglePlan).on("click",e+" .wpforms-panel-content-section-payment-plan-head-buttons-delete",WPFormsBuilderPaymentsUtils.deletePlan).on("input",n,WPFormsBuilderPaymentsUtils.renamePlan).on("focusout",n,WPFormsBuilderPaymentsUtils.checkPlanName))},customMetadataActions(){r("#wpforms-panel-payments").on("focusout",".wpforms-panel-field-stripe-custom-metadata-meta-key",function(){r(this).val(r(this).val().replace(/[^\p{L}\p{N}_-]/gu,""))}).on("click",".wpforms-panel-content-section-stripe-custom-metadata-add",function(e){e.preventDefault();var e=r(this).parents(".wpforms-panel-content-section-stripe-custom-metadata-table"),t=e.find("tr").last(),n=t.clone(!0),t=t.data("key"),i=t+1;n.attr("data-key",i),n.html(n.html().replaceAll("["+t+"]","["+i+"]").replaceAll("-"+t+"-","-"+i+"-")),n.find("select, input").val(""),n.find(".wpforms-panel-content-section-stripe-custom-metadata-delete").removeClass("hidden"),n.find(".wpforms-required-field-error").removeClass("wpforms-required-field-error"),e.find("tbody").append(n.get(0))}).on("click",".wpforms-panel-content-section-stripe-custom-metadata-delete",function(e){e.preventDefault(),r(this).parents(".wpforms-panel-content-section-stripe-custom-metadata-table tr").remove()})},bindUIActions(){r("#wpforms-builder").on("wpformsFieldDelete",a.disableNotifications).on("wpformsSaved",a.requiredFieldsCheck).on("wpformsFieldAdd",a.fieldAdded).on("wpformsFieldDelete",a.fieldDeleted).on("wpformsPaymentsPlanCreated",a.toggleMultiplePlansWarning).on("wpformsPaymentsPlanCreated",a.bindPlanUIActions).on("wpformsPaymentsPlanDeleted",a.toggleMultiplePlansWarning),i.$panelContent.find(".wpforms-panel-content-section-payment-one-time").on("change",".wpforms-panel-field-stripe-custom-metadata-meta-key",a.resetCustomMetaKeyErrorClass)},bindPlanUIActions(){i.$panelContent.find('.wpforms-panel-content-section-payment-plan-body .wpforms-panel-field-select select[name*="email"]').on("change",a.resetEmailAlertErrorClass),i.$panelContent.find(".wpforms-panel-content-section-payment-plan-body .wpforms-panel-field-stripe-custom-metadata-meta-key").on("change",a.resetCustomMetaKeyErrorClass),i.$panelContent.find(".wpforms-panel-content-section-payment-plan-period select").on("change",a.resetCyclesValues)},requiredFieldsCheck(){let e=a.validateFields();e?.invalid&&a.openAlert(a.getAlertMessage(e.type),()=>e.invalid.$element.focus())},validateFields(){var e;return!!i.$panelContent.hasClass("wpforms-hidden")||(e={},r("#wpforms-panel-field-stripe-enable_one_time").is(":checked")&&a.validateOneTimeFields(e),r("#wpforms-panel-field-stripe-enable_recurring").is(":checked")&&a.validateRecurringFields(e),e)},validateOneTimeFields(e){var t=i.$panelContent.find(".wpforms-panel-content-section-payment-one-time");e.type="one-time",a.validateCustomMetaTable(t,e)},validateRecurringFields(t){t.type=t.type?"both":"recurring",i.$panelContent.find(".wpforms-panel-content-section-payment-plan").each(function(){var e=r(this);a.validateEmailField(e,t),a.validateCustomMetaTable(e,t)})},validateEmailField(e,t){e=e.data("plan-id"),e=r(`#wpforms-panel-field-stripe-recurring-${e}-email`);e.val()||(e.addClass("wpforms-required-field-error"),t.invalid=t.invalid??{},t.invalid.email=!0,t.invalid.$element)||(t.invalid.$element=e)},validateCustomMetaTable(e,t){e=e.find(".wpforms-panel-content-section-stripe-custom-metadata-table tr[data-key]");if(!e.length)return!0;e.each(function(){var e=r(this);a.isValidCustomMetaRow(e)||(t.invalid=t.invalid??{},t.invalid.customMeta=!0,t.invalid.$element)||(t.invalid.$element=e.find(".wpforms-panel-field-stripe-custom-metadata-meta-key"))})},isValidCustomMetaRow(e){var t=e.find(".wpforms-panel-field-stripe-custom-metadata-meta-key"),e=!e.find(".wpforms-panel-field-stripe-custom-metadata-object-type").val()||!e.find(".wpforms-panel-field-stripe-custom-metadata-meta-value").val()||t.val();return t.toggleClass("wpforms-required-field-error",!e),e},resetEmailAlertErrorClass(){r(this).toggleClass("wpforms-required-field-error",!r(this).val())},resetCustomMetaKeyErrorClass(){var e=r(this).closest("tr[data-key]");a.isValidCustomMetaRow(e)},recurringEmailAlert(){console.warn('WARNING! Function "WPFormsStripeModernBuilder.recurringEmailAlert()" has been deprecated, please use the "WPFormsStripeModernBuilder.openAlert()" function instead!'),a.openAlert(wpforms_builder.stripe_recurring_email)},openAlert(e,t=()=>{}){r.alert({title:wpforms_builder.stripe_recurring_heading,content:e,icon:"fa fa-exclamation-circle",type:"red",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",keys:["enter"],action:t}},onOpen(){r(".wpforms-stripe-settings-redirect").on("click",a.settingsRedirect)}})},getAlertMessage(e){var t;return r(".wpforms-panel-content-section-stripe").is(":visible")?(t={"one-time":"stripe_required_one_time_fields",recurring:"stripe_required_recurring_fields",both:"stripe_required_both_fields"},wpforms_builder[t[e]??t.recurring]):wpforms_builder.stripe_recurring_settings},settingsRedirect(){r(".wpforms-panel-payments-button").trigger("click"),r(".wpforms-panel-sidebar-section-stripe").trigger("click"),e.location.href=e.location.pathname+e.location.search+"#wpforms-panel-field-stripe-enable_recurring-wrap",r(this).closest(".jconfirm-box").find(".btn-confirm").trigger("click")},disableNotifications(e,t,n){a.isStripeField(n)&&!a.hasStripeCreditCardFieldInBuilder()&&((n=r('.wpforms-panel-content-section-notifications [id*="-stripe-wrap"]')).find('input[id*="-stripe"]').prop("checked",!1),n.addClass("wpforms-hidden"))},isLegacySettings(){return r("#wpforms-panel-field-stripe-enable").length},fieldAdded(e,t,n){a.isStripeField(n)&&a.hasStripeCreditCardFieldInBuilder()&&(a.settingsToggle(!0),i.$feeNotice.toggleClass("wpforms-hidden"))},fieldDeleted(e,t,n){!a.isStripeField(n)||a.hasStripeCreditCardFieldInBuilder()||(a.settingsToggle(!1),a.disablePayments(),i.$feeNotice.toggleClass("wpforms-hidden"))},isStripeField(e){return e===wpforms_builder_stripe.field_slug},hasStripeCreditCardFieldInBuilder(){return 0<r(".wpforms-field.wpforms-field-"+wpforms_builder_stripe.field_slug).length},toggleMultiplePlansWarning(){i.$panelContent.find(".wpforms-stripe-multiple-plans-warning").toggleClass("wpforms-hidden",1===i.$panelContent.find(".wpforms-panel-content-section-payment-plan").length)},settingsToggle(e){(i.$alert.length||i.$panelContent.length)&&(i.$alert.toggleClass("wpforms-hidden",e),i.$panelContent.toggleClass("wpforms-hidden",!e))},toggleContent(){console.warn('WARNING! Function "WPFormsStripeModernBuilder.toggleContent()" has been deprecated, please use the new "WPFormsPaymentsUtils.toggleContent()" function instead!'),WPFormsBuilderPaymentsUtils.toggleContent()},togglePlan(){console.warn('WARNING! Function "WPFormsStripeModernBuilder.togglePlan()" has been deprecated, please use the new "WPFormsPaymentsUtils.togglePlan()" function instead!'),WPFormsBuilderPaymentsUtils.togglePlan()},deletePlan(){console.warn('WARNING! Function "WPFormsStripeModernBuilder.checkPlanName()" has been deprecated, please use the new "WPFormsPaymentsUtils.deletePlan()" function instead!'),WPFormsBuilderPaymentsUtils.deletePlan()},checkPlanName(){console.warn('WARNING! Function "WPFormsStripeModernBuilder.checkPlanName()" has been deprecated, please use the new "WPFormsPaymentsUtils.checkPlanName()" function instead!'),WPFormsBuilderPaymentsUtils.checkPlanName()},renamePlan(){console.warn('WARNING! Function "WPFormsStripeModernBuilder.renamePlan()" has been deprecated, please use the new "WPFormsPaymentsUtils.renamePlan()" function instead!'),WPFormsBuilderPaymentsUtils.renamePlan()},disablePayments(){r("#wpforms-panel-field-stripe-enable_one_time, #wpforms-panel-field-stripe-enable_recurring").prop("checked",!1).trigger("change").each(WPFormsBuilderPaymentsUtils.toggleContent)},resetCyclesValues(){var e=r(this),t=e.closest(".wpforms-panel-content-section-payment-plan-body").find(".wpforms-panel-content-section-payment-plan-cycles select"),n=t.val();let i;switch(e.val()){case"yearly":i=20;break;case"semiyearly":i=40;break;case"quarterly":i=80;break;default:i=wpforms_builder_stripe.cycles_max}var a=[r("<option>",{value:"unlimited",text:wpforms_builder_stripe.i18n.cycles_default})];for(let e=1;e<=i;e++)a.push(r("<option>",{value:e,text:e}));t.empty().append(a).val(n),t.val()!==n&&t.val("unlimited")}};return a})((document,window),jQuery);WPFormsStripeModernBuilder.init();