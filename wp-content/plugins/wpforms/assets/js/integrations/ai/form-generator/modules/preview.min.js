export default function(r,s){const a=wpforms_ai_form_generator,i={el:{},mouse:{},init(){i.el.$contentWrap=r.main.el.$generatorPanel.find(".wpforms-panel-content-wrap"),i.el.$content=i.el.$contentWrap.find(".wpforms-panel-content"),i.el.$emptyState=i.el.$content.find(".wpforms-panel-empty-state"),i.events()},events(){s(document).on("mousemove",e=>{i.mouse.x=e.pageX,i.mouse.y=e.pageY}),i.el.$contentWrap.on("scroll",i.closeTooltips)},update(){var e=r.state.aiResponse;if(e&&e.fields){r.state.isPreviewUpdate=!0,r.state.previewFields=[],i.clear(!1),i.displayHeader(e);for(const o in e.fieldsOrder){var t=e.fieldsOrder[o];i.field(e.fields[t],o)}e.fieldsOrder?.length?i.displaySubmit(e.settings?.submit_text||a.panel.submitButton):(i.el.$emptyState.removeClass("wpforms-hidden-strict"),r.state.isPreviewUpdate=!1)}},async field(t,e){var o=`
				<div id="wpforms-generator-field-${t.id??""}" class="wpforms-ai-form-generator-preview-field">
					<div class="placeholder"></div>
					<div class="wpforms-field wpforms-field-${t.type??""}"></div>
				</div>
			`,o=(i.el.$content.append(o),{action:"wpforms_get_ai_form_field_preview",nonce:a.nonce,field:t});await i.delay(300*e),s.post(a.ajaxUrl,o).done(function(e){e.success?i.displayField(e.data??"",t):wpf.debug("Form Generator AJAX error:",e.data.error??e.data)}).fail(function(e){wpf.debug("Form Generator AJAX error:",e.responseText??e.statusText)})},displayField(e,t){var o,s;!t.id&&0!==t.id||(s=(o=i.el.$content.find("#wpforms-generator-field-"+t.id)).find(".wpforms-field"),o.find(".placeholder").addClass("fade-out"),s.html(e??"").addClass("fade-in").toggleClass("wpforms-hidden",!e).toggleClass("required","1"===t.required).toggleClass("label_empty",!t.label),i.initTooltip(s),i.initPageBreak(s,t),r.state.previewFields.push(t.id),r.state.previewFields.length!==Object.keys(r.state.aiResponse?.fields).length)||(r.state.isPreviewUpdate=!1,i.displayAddonsNotice())},displayAddonsNotice(){var e,t,o,s;a.dismissed.previewNotice||["basic","plus"].includes(a.licenseType)&&(e=i.getAddonsUsedInResponse()).length&&(e=a.previewNotice.title+" "+e,t=a.previewNotice.btnUpgrade,o=`data-action="upgrade" data-name="${a.previewNotice.addons}" data-utm-content="AI Form Generator"`,s=a.previewNotice.msgUpgrade.replace('href="#"','href="#" class="education-modal" '+o),i.el.$content.append(`
					<div class="wpforms-alert wpforms-alert-success wpforms-ai-form-generator-preview-addons-notice wpforms-dismiss-container">
						<div class="wpforms-alert-message">
							<h4>${e}</h4>
							<p>${s}</p>
						</div>
						<div class="wpforms-alert-buttons">
							<a href="#" target="_blank" rel="noopener noreferrer" class="wpforms-btn wpforms-btn-sm wpforms-btn-light-grey education-modal" ${o}>${t}</a>
							<button type="button" class="wpforms-dismiss-button" title="${a.previewNotice.dismiss}" data-section="ai-forms-preview-addons-notice" />
						</div>
					</div>
				`))},getAddonsUsedInResponse(){var e=r.state.aiResponse;if(!e||!e.fields)return"";var t,o=[];for(const i in e.fields){var s=wpforms_ai_form_generator.addonFields[e.fields[i].type];s&&(s=wpforms_addons["wpforms-"+s]?.title.replace(a.addons.addon,"").trim())&&!o.includes(s)&&o.push(s)}return o.length?(t=o.pop(),t+=" "+a.addons.addon,o.length?o.join(", ")+", "+a.addons.and+" "+t:t):""},initPageBreak(e,t){"pagebreak"!==t.type||["top","bottom"].includes(t.position)||e.addClass("wpforms-pagebreak-normal")},initTooltip(e){var t={content:a.panel.tooltipTitle+"<br>"+a.panel.tooltipText,trigger:"manual",interactive:!0,animationDuration:100,delay:0,side:["top"],contentAsHTML:!0,functionPosition:(e,t,o)=>(o.coord.top=i.mouse.y-57,o.coord.left=i.mouse.x-130,o)};e.tooltipster(t),i.toggleTooltipOnClick(e)},toggleTooltipOnClick(t){t.on("click",()=>{i.closeTooltips();var e=t.tooltipster("status");t.tooltipster("closed"===e.state?"open":"close"),"closed"===e.state&&((e=t.tooltipster("instance"))._$tooltip.css({height:"auto"}),e._$tooltip.find(".tooltipster-arrow").css({left:"50%"}),setTimeout(function(){i.closeTooltips()},5e3))})},closeTooltips(){i.el.$content.find(".wpforms-field").each(function(){var e=s(this);e.hasClass("tooltipstered")&&e.parent().length&&e.tooltipster("close")})},displayHeader(e){e=`<h2 class="wpforms-ai-form-generator-preview-title">${e.form_title??""}</h2>`;i.el.$content.prepend(e)},displaySubmit(e){i.el.$content.append(`<button type="button" value="${e}" class="wpforms-ai-form-generator-preview-submit">${e}</button>`)},clear(e=!0){i.el.$content.find(".wpforms-ai-form-generator-preview-field").remove(),i.el.$content.find(".wpforms-ai-form-generator-preview-placeholder").remove(),i.el.$content.find(".wpforms-ai-form-generator-preview-title").remove(),i.el.$content.find(".wpforms-ai-form-generator-preview-addons-notice").remove(),i.el.$content.find(".wpforms-ai-form-generator-preview-submit").remove(),i.el.$emptyState.toggleClass("wpforms-hidden-strict",!e)},delay(t){return new Promise(e=>{setTimeout(e,t)})}};return i}