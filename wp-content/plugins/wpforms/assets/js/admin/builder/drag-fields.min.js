var WPForms=window.WPForms||{};WPForms.Admin=WPForms.Admin||{},WPForms.Admin.Builder=WPForms.Admin.Builder||{},WPForms.Admin.Builder.DragFields=WPForms.Admin.Builder.DragFields||((e,c,g)=>{let w=!1,h=[],F=!1,a=[],d=new Map,v={},b={},y={init(){g(y.ready)},ready(){y.setup(),y.initSortableFields(),y.events()},setup(){v={$builder:g("#wpforms-builder"),$sortableFieldsWrap:g("#wpforms-panel-fields .wpforms-field-wrap"),$addFieldsButtons:g(".wpforms-add-fields-button").not(".not-draggable").not(".warning-modal").not(".education-modal")}},events(){v.$builder.on("wpformsFieldDragToggle",y.fieldDragToggleEvent).on("wpformsFieldAdd",function(e,l,r){"layout"===r&&setTimeout(function(){g("#wpforms-field-"+l).find(".wpforms-layout-column").each(function(){y.initSortableHandler(g(this)),g(this).sortable("enable")})},100)}),g(e).on("wpformsLayoutPresetChanged",y.layoutPresetChanged)},disableDragAndDrop(){v.$sortableFieldsWrap.trigger("initSortableImmediately"),v.$addFieldsButtons.filter(".ui-draggable").draggable("disable"),v.$sortableFieldsWrap.sortable("disable"),v.$sortableFieldsWrap.find(".wpforms-layout-column.ui-sortable").data("ui-sortable")&&v.$sortableFieldsWrap.find(".wpforms-layout-column.ui-sortable").sortable("disable")},enableDragAndDrop(){v.$addFieldsButtons.filter(".ui-draggable").draggable("enable"),v.$sortableFieldsWrap.sortable("enable"),v.$sortableFieldsWrap.find(".wpforms-layout-column.ui-sortable").sortable("enable")},fieldDragDisable(e,i=!0){if(e.hasClass("ui-draggable-disabled"))e.draggable("enable");else{let r;e.draggable({revert:!0,axis:"y",delay:100,opacity:1,cursor:"move",start(e,l){r=l.position.top},drag(e,l){if(15<Math.abs(l.position.top)-Math.abs(r))return i&&y.showErrorPopup({content:wpforms_builder.field_cannot_be_reordered}),!1}})}},fieldDragEnable(e){e.hasClass("ui-draggable")||e.draggable("disable")},showErrorPopup(e){var{title:e=wpforms_builder.heads_up,content:l,icon:r="fa fa-exclamation-circle",type:i="red",buttonText:t=wpforms_builder.ok}=e;g.confirm({title:e,content:l,icon:r,type:i,buttons:{confirm:{text:t,btnClass:"btn-confirm",keys:["enter"]}}})},fieldDragToggleEvent(e,l){l=g("#wpforms-field-"+l);l.hasClass("wpforms-field-not-draggable")||l.hasClass("wpforms-field-stick")?y.fieldDragDisable(l):y.fieldDragEnable(l)},initSortableFields(){y.initSortableContainer(v.$sortableFieldsWrap);function e(){v.$builder.find(".wpforms-layout-column").each(function(){y.initSortableHandler(g(this)),g(this).sortable("enable")})}e(),setTimeout(e,500),y.fieldDragDisable(g(".wpforms-field-not-draggable, .wpforms-field-stick")),y.initDraggableFields()},async initSortableContainer(e){y.initSortableHandler(e)},async layoutPresetChanged(e,l){l=g(l).data("field-id");g(`#wpforms-field-${l} .wpforms-layout-column`).each(function(){y.initSortableHandler(g(this)),g(this).sortable("enable")})},initSortableHandler(o){let t=g("#wpforms-field-options"),d=g("#wpforms-panel-fields .wpforms-panel-content-wrap"),a,s,n,f,m,p,u=!1;o.sortable({items:"> .wpforms-field:not(.wpforms-field-stick):not(.no-fields-preview):not(.wpforms-field-multi-drag)",connectWith:".wpforms-field-wrap, .wpforms-layout-column",delay:100,opacity:1,cursor:"move",cancel:".wpforms-field-not-draggable",placeholder:"wpforms-field-drag-placeholder",appendTo:"#wpforms-panel-fields",zindex:1e4,tolerance:"pointer",distance:1,start(e,l){a=l.item.data("field-id"),s=l.item.data("field-type"),n=void 0===a,f=g("#wpforms-field-option-"+a),h=WPForms.Admin.Builder.MultiSelect?.getSelectedFields(),v.$builder.trigger("wpformsBeforeFieldDragStart",[a,h]),1<h?.length&&h.includes(a)?(w=!0,y.multiSelect.initDrag()):y.multiSelect.cleanupState(),b.fieldReceived=!1,b.fieldRejected=!1,b.$sortableStart=o,b.startPosition=l.item.first().index(),v.$builder.trigger("wpformsFieldDragStart",[a,h])},beforeStop(e,l){!b.glitchChange||y.isFieldAllowedInColumn(s,l.item.first().parent())||(b.fieldRejected=!0)},stop(e,l){var r,i=l.item.first();if(w&&0<h.length)return F?void y.multiSelect.revertMoveFieldsToColumn():void y.multiSelect.handleSuccess(l,i);i.hasClass("wpforms-field-layout")&&i.find(".wpforms-layout-column").each(function(){y.initSortableHandler(g(this)),g(this).sortable("enable")}),i.parent().hasClass("wpforms-field-wrap")&&c.wpformsLastReceive&&c.wpformsLastReceive.isColumn&&!i.hasClass("wpforms-field-layout")&&!i.hasClass("wpforms-field-repeater")&&(i.detach(),c.wpformsLastReceive.sortable.append(i),b.fieldRejected=!0,c.wpformsLastReceive=null,c.wpformsLastReceiveForMainWrap=null),l.placeholder.removeClass("wpforms-field-drag-not-allowed"),i.removeClass("wpforms-field-drag-not-allowed"),b.fieldRejected?(r=n?o:i.parent(),y.revertMoveFieldToColumn(i),v.$builder.trigger("wpformsFieldMoveRejected",[i,l,r])):(p=i.prev(".wpforms-field, .wpforms-alert").data("field-id"),0<(m=g("#wpforms-field-option-"+p)).length?m.after(f):t.prepend(f),!n&&i.closest(".wpforms-layout-column").is(o)&&WPForms.Admin.Builder.FieldLayout?.positionFieldInColumn(a,i.index()-1,o),r=i.closest(".wpforms-field-layout, .wpforms-field-repeater"),WPForms.Admin.Builder.FieldLayout?.fieldOptionsUpdate(null,a),WPForms.Admin.Builder.FieldLayout?.reorderLayoutFieldsOptions(r),n||i.removeClass("wpforms-field-dragging").removeClass("wpforms-field-drag-over"),i.attr("style",""),v.$builder.trigger("wpformsFieldMove",[l,a]),b.fieldReceived=!1)},over(e,l){var l=l.item.first(),e=g(e.target),r=e.find(".wpforms-field-drag-placeholder"),i=e.hasClass("wpforms-layout-column"),t={width:e.outerWidth(),height:l.outerHeight()};let d=i?" wpforms-field-drag-to-column":"";i&&(o=e.attr("class").match(/wpforms-layout-column-(\d+)/)[1],d=(d+=" wpforms-field-drag-to-column-"+o)+" wpforms-field-drag-to-"+e.parents(".wpforms-field").data("field-type")),a=l.data("field-id"),s=l.data("field-type")||b.fieldType,n=void 0===a,l.addClass("wpforms-field-dragging"+d),i&&WPForms.Admin.Builder.FieldLayout?.isLayoutBasedField(s)||l.css({width:i?t.width-5:t.width,height:"auto"});var o=i?90:t.height;r.removeClass("wpforms-field-drag-not-allowed").css({height:n?o+18:t.height}),i&&!y.isFieldAllowedInColumn(s,e)&&(r.addClass("wpforms-field-drag-not-allowed"),l.addClass("wpforms-field-drag-not-allowed")),w&&1<h.length&&y.multiSelect.handleFieldRestrictionsOver(r,l,e),v.$builder.trigger("wpformsFieldDragOver",[a,e]),n&&l.addClass("wpforms-field-drag-over").removeClass("wpforms-field-drag-out")},out(e,l){var r=l.item.first(),i=void 0===r.data("field-id");r.removeClass("wpforms-field-drag-not-allowed").removeClass("wpforms-field-drag-to-repeater").removeClass("wpforms-field-drag-to-layout").removeClass(y.getDragColumnClasses(r.attr("class"))),b.fieldReceived?r.attr("style",""):i?r.addClass("wpforms-field-drag-out").removeClass("wpforms-field-drag-over"):g(l.sender).closest(".wpforms-field-layout, .wpforms-field-repeater").removeClass("wpforms-field-child-hovered")},receive(e,l){var r=o.hasClass("wpforms-layout-column"),i=o.hasClass("wpforms-field-wrap");if(c.wpformsLastReceive={isColumn:r,isMainWrap:i,sender:l.sender?g(l.sender).attr("class"):null,sortable:o,time:(new Date).getTime()},r&&c.wpformsLastReceiveForMainWrap&&(new Date).getTime()-c.wpformsLastReceiveForMainWrap.time<100)b.fieldRejected=!0,c.wpformsLastReceiveForMainWrap=null,c.wpformsLastReceive=null;else{i&&(c.wpformsLastReceiveForMainWrap=c.wpformsLastReceive);var i=g(l.helper||l.item),t=(a=i.data("field-id"),s=i.data("field-type")||b.fieldType,void 0===a);if(r&&!y.isFieldAllowedInColumn(s,o))b.fieldRejected=!0;else{if(r&&w&&1<h.length){if(y.multiSelect.hasRestrictedInColumnFields(o))return b.fieldRejected=!0,void(F=!0);var d=o.closest(".wpforms-field-repeater").data("field-id");if(WPForms.Admin.Builder.FieldRepeater?.isRepeaterWithRowsDisplay?.(d))return b.fieldRejected=!0,void(F=!0)}if(b.fieldReceived=!0,i.removeClass("wpforms-field-drag-over"),!t)return w&&0<h.length?void y.multiSelect.handleMultiSelectDragToMainContainer():void WPForms.Admin.Builder.FieldLayout?.receiveFieldToColumn(a,l.item.index()-1,i.parent());d=o.data("ui-sortable")?.currentItem?.index()||0;i.addClass("wpforms-field-drag-over wpforms-field-drag-pending").removeClass("wpforms-field-drag-out").append(WPFormsBuilder.settings.spinnerInline).css("width","100%"),v.$builder.find(".no-fields-preview").remove(),WPFormsBuilder.fieldAdd(b.fieldType,{position:r?d-1:d,placeholder:i,$sortable:o}),b.fieldType=void 0}}},change(e,l){l=l.placeholder.parent(),e=g(e.target);b.glitchChange=!1,!o.is(l)&&o.hasClass("wpforms-field-wrap")&&l.hasClass("wpforms-layout-column")&&(b.glitchChange=!0),v.$builder.trigger("wpformsFieldDragChange",[a,e])},sort(l){if(!u){var l=l.clientY,r=d.offset(),i=d.height(),t=r.top+i;let e;if(l>r.top&&l<r.top+50)e="-=";else{if(!(t-50<l&&l<t))return;e="+="}u=!0,d.animate({scrollTop:e+i/3+"px"},800,function(){u=!1})}}})},getDragColumnClasses(e){return(e.match(/wpforms-field-drag-to-column(-\d+|)/g)||[]).join(" ")},initDraggableFields(){v.$addFieldsButtons.draggable({connectToSortable:".wpforms-field-wrap, .wpforms-layout-column",delay:200,cancel:!1,scroll:!1,opacity:1,appendTo:"#wpforms-panel-fields",zindex:1e4,helper(){var e=g(this),l=g('<div class="wpforms-field-drag-out wpforms-field-drag">');return b.fieldType=e.data("field-type"),l.html(e.html())},start(e,l){if(WPFormsUtils.triggerEvent(v.$builder,"wpformsFieldAddDragStart",[b.fieldType,l]).isDefaultPrevented())return!1},stop(e,l){if(WPFormsUtils.triggerEvent(v.$builder,"wpformsFieldAddDragStop",[b.fieldType,l]).isDefaultPrevented())return!1}})},isFieldAllowedInColumn(e,l){var r;return!WPForms.Admin.Builder.FieldLayout||(r=WPForms.Admin.Builder.FieldLayout?.isFieldAllowedInColumn(e,l),wp.hooks.applyFilters("wpforms.LayoutField.isFieldAllowedDragInColumn",r,e,l))},revertMoveFieldToColumn(e){var l;void 0===e.data("field-id")?e.remove():(e=e.detach(),l=b.$sortableStart.find("> .wpforms-field").eq(b.startPosition),e.removeClass("wpforms-field-dragging").removeClass("wpforms-field-drag-over").attr("style",""),l.length?l.before(e):b.$sortableStart.append(e))},multiSelect:{revertMoveFieldsToColumn(){var e=[...h].reverse();let i=[];e.forEach(e=>{var l=g("#wpforms-field-"+e),r=d.get(e);l.length&&r&&r.parent&&r.parent.length&&i.push({fieldElement:l[0],parentElement:r.parent[0],index:Number.isFinite(r.index)?r.index:0,fieldId:e})}),i.sort((e,l)=>e.parentElement===l.parentElement?l.index-e.index:0).forEach(e=>{var{fieldElement:e,parentElement:l,index:r}=e,r=l.children[r];r&&r!==e?r.before(e):r||l.appendChild(e)}),y.showErrorPopup({title:wpforms_builder.repeater.not_allowed,content:wpforms_builder.repeater.multi_select_to_rows_rejected_alert}),WPForms.Admin.Builder.MultiSelectActions?.updateFirstSelectedClass(),y.multiSelect.cleanupState(!0,!0)},handleSuccess(e,l){var r=l.parent(),i=r.hasClass("wpforms-layout-column"),t=Number.parseInt(l.data("field-id"),10),d=a.indexOf(t),o=a.slice(d+1),d=a.slice(0,d);y.multiSelect.processMainDraggedField(l,i),y.multiSelect.moveFieldsAfterDragged(o,l,i,r),y.multiSelect.moveFieldsBeforeDragged(d,l,i,r),y.multiSelect.handleFieldsMovedOutOfLayouts(),y.multiSelect.reorderLayoutOptions(l),y.multiSelect.adjustRepeaterFieldsAppearance(),WPForms.Admin.Builder.MultiSelectActions?.updateFirstSelectedClass(),v.$builder.trigger("wpformsMultiFieldMove",[e,t,h]),y.multiSelect.cleanupState()},initDrag(){d.clear(),F=!1,a=[],v.$builder.find(".wpforms-field").each(function(){var e=g(this).data("field-id");e&&h.includes(e)&&a.push(e)}),y.multiSelect.includeContainerFieldChildren(),h.forEach(e=>{var l=g("#wpforms-field-"+e),r=l.parent(),i=l.next(),t=l.index(),l=(l.addClass("wpforms-field-multi-drag"),{parent:r,nextSibling:i,index:t});d.set(e,l)}),v.$sortableFieldsWrap.sortable("refresh"),v.$sortableFieldsWrap.find(".wpforms-layout-column.ui-sortable").each(function(){g(this).sortable("refresh")})},cleanupState(e=!1,l=!1){w=!1,h=[],a=[],e&&d.clear();e=g("#wpforms-panel-fields .wpforms-field");l&&(F=!1,e.attr("style","")),e.removeClass("wpforms-field-multi-drag").removeClass("wpforms-field-dragging")},processMainDraggedField(e,l){var r;l&&(l=Number.parseInt(e.data("field-id"),10),r=e.parent(),WPForms.Admin.Builder.FieldLayout?.receiveFieldToColumn(l,e.index()-1,r),WPForms.Admin.Builder.FieldLayout?.fieldOptionsUpdate(null,l))},moveFieldsAfterDragged(e,l,i,t){let d=l,o=g("#wpforms-field-option-"+l.data("field-id"));e.forEach(e=>{var l=g("#wpforms-field-"+e),r=g("#wpforms-field-option-"+e);l.length&&r.length&&(l.detach(),d.after(l),i&&(WPForms.Admin.Builder.FieldLayout?.receiveFieldToColumn(e,l.index()-1,t),WPForms.Admin.Builder.FieldLayout?.fieldOptionsUpdate(null,e)),o.length&&(r.detach(),o.after(r)),d=l,o=r,v.$builder.trigger("wpformsFieldMove",[{item:l},e,h]))});l=g("#wpforms-panel-fields .wpforms-field");let r=[];l.each(function(){var e=g(this).data("field-id");e&&r.push(e)}),r.forEach(e=>{e=g("#wpforms-field-option-"+e);e.length&&(e.detach(),g("#wpforms-field-options").append(e))})},moveFieldsBeforeDragged(e,t,d,o){let a=Number.parseInt(t.data("field-id"),10);e.reverse().forEach(e=>{var l,r=g("#wpforms-field-"+e),i=g("#wpforms-field-option-"+e);r.length&&i.length&&(r.detach(),t.before(r),d&&(WPForms.Admin.Builder.FieldLayout?.receiveFieldToColumn(e,r.index()-1,o),WPForms.Admin.Builder.FieldLayout?.fieldOptionsUpdate(null,e)),(l=g("#wpforms-field-option-"+a)).length&&(i.detach(),l.before(i)),v.$builder.trigger("wpformsFieldMove",[{item:r},e,h]))})},reorderLayoutOptions(e){e=e.closest(".wpforms-field-layout, .wpforms-field-repeater");e.length&&WPForms.Admin.Builder.FieldLayout?.reorderLayoutFieldsOptions(e)},handleFieldsMovedOutOfLayouts(){a.forEach(e=>{var l=g("#wpforms-field-"+e),r=d.get(e)?.parent;l.length&&r&&r.length&&(r=r.hasClass("wpforms-layout-column"),l=0===l.closest(".wpforms-field-layout, .wpforms-field-repeater").length,r)&&l&&WPForms.Admin.Builder.FieldLayout?.removeFieldFromColumns(e)})},handleMultiSelectDragToMainContainer(){let l=new Set;return h.forEach(e=>{e=g("#wpforms-field-"+e).closest(".wpforms-field-layout, .wpforms-field-repeater");e.length&&l.add(e.get(0))}),h.forEach(e=>{var l=g("#wpforms-field-"+e),r=d.get(e)?.parent;l.length&&r?.length&&(r.hasClass("wpforms-layout-column")?(WPForms.Admin.Builder.FieldLayout?.removeFieldFromColumns(e),WPForms.Admin.Builder.FieldLayout?.fieldOptionsUpdate(null,e),setTimeout(()=>{y.multiSelect.cleanupFieldMarginWhenMovedToBase(e)},0)):(WPForms.Admin.Builder.FieldLayout?.receiveFieldToColumn(e,l.index()-1,r),WPForms.Admin.Builder.FieldLayout?.fieldOptionsUpdate(null,e)))}),l.forEach(e=>{WPForms.Admin.Builder.FieldLayout?.reorderLayoutFieldsOptions(g(e))}),!0},hasRestrictedInColumnFields(l){return h.some(e=>{e=g("#wpforms-field-"+e);return!y.isFieldAllowedInColumn(e.data("field-type"),l)})},handleFieldRestrictionsOver(e,l,r){var i=r.hasClass("wpforms-layout-column"),t=y.multiSelect.hasRestrictedInColumnFields(r);F=(i&&t||(i=r.closest(".wpforms-field-repeater").data("field-id"),!!WPForms.Admin.Builder.FieldRepeater?.isRepeaterWithRowsDisplay?.(i)))&&(e.addClass("wpforms-field-drag-not-allowed"),l.addClass("wpforms-field-drag-not-allowed"),!0)},includeContainerFieldChildren(){h.filter(e=>{e=g("#wpforms-field-"+e).data("field-type");return"repeater"===e||"layout"===e}).forEach(e=>{g("#wpforms-field-"+e).find(".wpforms-field").each(function(){var e=g(this),l=e.data("field-id");l&&!h.includes(l)&&(h.push(l),e.addClass("selected"))})})},adjustRepeaterFieldsAppearance(){let l=new Set;a.forEach(e=>{var e=d.get(e)?.parent;e&&e.length&&(e=e.closest(".wpforms-field-repeater")).length&&l.add(e.data("field-id"))}),a.forEach(e=>{e=g("#wpforms-field-"+e).closest(".wpforms-field-repeater");e.length&&l.add(e.data("field-id"))}),l.forEach(e=>{WPForms.Admin.Builder.FieldRepeater?.adjustRowsAppearance?.(e)})},cleanupFieldMarginWhenMovedToBase(e){e=g("#wpforms-field-"+e);e.length&&!e.closest(".wpforms-layout-column").length&&(e[0].style.marginBottom=null)}}};return y})(document,window,jQuery),WPForms.Admin.Builder.DragFields.init();