var WPForms=window.WPForms||{};WPForms.Admin=WPForms.Admin||{},WPForms.Admin.Builder=WPForms.Admin.Builder||{},WPForms.Admin.Builder.DragFields=WPForms.Admin.Builder.DragFields||((e,g,w)=>{let c={},b={},F,v={init(){w(v.ready)},ready(){v.setup(),v.initSortableFields(),v.events()},setup(){c={$builder:w("#wpforms-builder"),$sortableFieldsWrap:w("#wpforms-panel-fields .wpforms-field-wrap"),$addFieldsButtons:w(".wpforms-add-fields-button").not(".not-draggable").not(".warning-modal").not(".education-modal")}},events(){c.$builder.on("wpformsFieldDragToggle",v.fieldDragToggleEvent).on("wpformsFieldAdd",function(e,r,l){"layout"===l&&setTimeout(function(){w("#wpforms-field-"+r).find(".wpforms-layout-column").each(function(){v.initSortableHandler(w(this)),w(this).sortable("enable")})},100)}),w(e).on("wpformsLayoutPresetChanged",v.layoutPresetChanged)},disableDragAndDrop(){c.$sortableFieldsWrap.trigger("initSortableImmediately"),c.$addFieldsButtons.filter(".ui-draggable").draggable("disable"),c.$sortableFieldsWrap.sortable("disable"),c.$sortableFieldsWrap.find(".wpforms-layout-column.ui-sortable").data("ui-sortable")&&c.$sortableFieldsWrap.find(".wpforms-layout-column.ui-sortable").sortable("disable")},enableDragAndDrop(){c.$addFieldsButtons.filter(".ui-draggable").draggable("enable"),c.$sortableFieldsWrap.sortable("enable"),c.$sortableFieldsWrap.find(".wpforms-layout-column.ui-sortable").sortable("enable")},fieldDragDisable(e,i=!0){if(e.hasClass("ui-draggable-disabled"))e.draggable("enable");else{let l;e.draggable({revert:!0,axis:"y",delay:100,opacity:1,cursor:"move",start(e,r){l=r.position.top},drag(e,r){if(15<Math.abs(r.position.top)-Math.abs(l))return i&&v.youCantReorderFieldPopup(),!1}})}},fieldDragEnable(e){e.hasClass("ui-draggable")||e.draggable("disable")},youCantReorderFieldPopup(){w.confirm({title:wpforms_builder.heads_up,content:wpforms_builder.field_cannot_be_reordered,icon:"fa fa-exclamation-circle",type:"red",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",keys:["enter"]}}})},fieldDragToggleEvent(e,r){r=w("#wpforms-field-"+r);r.hasClass("wpforms-field-not-draggable")||r.hasClass("wpforms-field-stick")?v.fieldDragDisable(r):v.fieldDragEnable(r)},initSortableFields(){v.initSortableContainer(c.$sortableFieldsWrap);function e(){c.$builder.find(".wpforms-layout-column").each(function(){v.initSortableHandler(w(this)),w(this).sortable("enable")})}e(),setTimeout(e,500),v.fieldDragDisable(w(".wpforms-field-not-draggable, .wpforms-field-stick")),v.initDraggableFields()},async initSortableContainer(e){v.initSortableHandler(e)},async layoutPresetChanged(e,r){r=w(r).data("field-id");w(`#wpforms-field-${r} .wpforms-layout-column`).each(function(){v.initSortableHandler(w(this)),w(this).sortable("enable")})},initSortableHandler(a){let o=w("#wpforms-field-options"),d=w("#wpforms-panel-fields .wpforms-panel-content-wrap"),s,t,n,f,m,p,u=!1;a.sortable({items:"> .wpforms-field:not(.wpforms-field-stick):not(.no-fields-preview)",connectWith:".wpforms-field-wrap, .wpforms-layout-column",delay:100,opacity:1,cursor:"move",cancel:".wpforms-field-not-draggable",placeholder:"wpforms-field-drag-placeholder",appendTo:"#wpforms-panel-fields",zindex:1e4,tolerance:"pointer",distance:1,start(e,r){s=r.item.data("field-id"),t=r.item.data("field-type"),n=void 0===s,f=w("#wpforms-field-option-"+s),b.fieldReceived=!1,b.fieldRejected=!1,b.$sortableStart=a,b.startPosition=r.item.first().index(),c.$builder.trigger("wpformsFieldDragStart",[s])},beforeStop(e,r){!b.glitchChange||F.isFieldAllowedInColum(t,r.item.first().parent())||(b.fieldRejected=!0)},stop(e,r){var l=r.item.first(),i=l.parent();l.hasClass("wpforms-field-layout")&&l.find(".wpforms-layout-column").each(function(){v.initSortableHandler(w(this)),w(this).sortable("enable")}),i.hasClass("wpforms-field-wrap")&&g.wpformsLastReceive&&g.wpformsLastReceive.isColumn&&!l.hasClass("wpforms-field-layout")&&!l.hasClass("wpforms-field-repeater")&&(l.detach(),g.wpformsLastReceive.sortable.append(l),b.fieldRejected=!0,g.wpformsLastReceive=null,g.wpformsLastReceiveForMainWrap=null),r.placeholder.removeClass("wpforms-field-drag-not-allowed"),l.removeClass("wpforms-field-drag-not-allowed"),b.fieldRejected?(i=n?a:l.parent(),v.revertMoveFieldToColumn(l),c.$builder.trigger("wpformsFieldMoveRejected",[l,r,i])):(p=l.prev(".wpforms-field, .wpforms-alert").data("field-id"),0<(m=w("#wpforms-field-option-"+p)).length?m.after(f):o.prepend(f),!n&&l.closest(".wpforms-layout-column").is(a)&&F.positionFieldInColumn(s,l.index()-1,a),i=l.closest(".wpforms-field-layout, .wpforms-field-repeater"),F.fieldOptionsUpdate(null,s),F.reorderLayoutFieldsOptions(i),n||l.removeClass("wpforms-field-dragging").removeClass("wpforms-field-drag-over"),l.attr("style",""),c.$builder.trigger("wpformsFieldMove",r),b.fieldReceived=!1)},over(e,r){var r=r.item.first(),e=w(e.target),l=e.find(".wpforms-field-drag-placeholder"),i=e.hasClass("wpforms-layout-column"),o={width:e.outerWidth(),height:r.outerHeight()};let a=i?" wpforms-field-drag-to-column":"";i&&(d=e.attr("class").match(/wpforms-layout-column-(\d+)/)[1],a=(a+=" wpforms-field-drag-to-column-"+d)+" wpforms-field-drag-to-"+e.parents(".wpforms-field").data("field-type")),s=r.data("field-id"),t=r.data("field-type")||b.fieldType,n=void 0===s,r.addClass("wpforms-field-dragging"+a),i&&F.isLayoutBasedField(t)||r.css({width:i?o.width-5:o.width,height:"auto"});var d=i?90:o.height;l.removeClass("wpforms-field-drag-not-allowed").css({height:n?d+18:o.height}),i&&!F.isFieldAllowedInColum(t,e)&&(l.addClass("wpforms-field-drag-not-allowed"),r.addClass("wpforms-field-drag-not-allowed")),c.$builder.trigger("wpformsFieldDragOver",[s,e]),n&&r.addClass("wpforms-field-drag-over").removeClass("wpforms-field-drag-out")},out(e,r){var l=r.item.first(),i=void 0===l.data("field-id");l.removeClass("wpforms-field-drag-not-allowed").removeClass("wpforms-field-drag-to-repeater").removeClass("wpforms-field-drag-to-layout").removeClass(v.getDragColumnClasses(l.attr("class"))),b.fieldReceived?l.attr("style",""):i?l.addClass("wpforms-field-drag-out").removeClass("wpforms-field-drag-over"):w(r.sender).closest(".wpforms-field-layout, .wpforms-field-repeater").removeClass("wpforms-field-child-hovered")},receive(e,r){var l=w(r.helper||r.item),i=a.hasClass("wpforms-layout-column"),o=a.hasClass("wpforms-field-wrap");g.wpformsLastReceive={isColumn:i,isMainWrap:o,sender:r.sender?w(r.sender).attr("class"):null,sortable:a,time:(new Date).getTime()},i&&g.wpformsLastReceiveForMainWrap&&(new Date).getTime()-g.wpformsLastReceiveForMainWrap.time<100?(b.fieldRejected=!0,g.wpformsLastReceiveForMainWrap=null,g.wpformsLastReceive=null):(o&&(g.wpformsLastReceiveForMainWrap=g.wpformsLastReceive),s=l.data("field-id"),t=l.data("field-type")||b.fieldType,o=void 0===s,i&&!F.isFieldAllowedInColum(t,a)?b.fieldRejected=!0:(b.fieldReceived=!0,l.removeClass("wpforms-field-drag-over"),o?(o=a.data("ui-sortable")?.currentItem?.index()||0,l.addClass("wpforms-field-drag-over wpforms-field-drag-pending").removeClass("wpforms-field-drag-out").append(WPFormsBuilder.settings.spinnerInline).css("width","100%"),c.$builder.find(".no-fields-preview").remove(),WPFormsBuilder.fieldAdd(b.fieldType,{position:i?o-1:o,placeholder:l,$sortable:a}),b.fieldType=void 0):F.receiveFieldToColumn(s,r.item.index()-1,l.parent())))},change(e,r){r=r.placeholder.parent(),e=w(e.target);b.glitchChange=!1,!a.is(r)&&a.hasClass("wpforms-field-wrap")&&r.hasClass("wpforms-layout-column")&&(b.glitchChange=!0),c.$builder.trigger("wpformsFieldDragChange",[s,e])},sort(r){if(!u){var r=r.clientY,l=d.offset(),i=d.height(),o=l.top+i;let e;if(r>l.top&&r<l.top+50)e="-=";else{if(!(o-50<r&&r<o))return;e="+="}u=!0,d.animate({scrollTop:e+i/3+"px"},800,function(){u=!1})}}})},getDragColumnClasses(e){return(e.match(/wpforms-field-drag-to-column(-\d+|)/g)||[]).join(" ")},initDraggableFields(){c.$addFieldsButtons.draggable({connectToSortable:".wpforms-field-wrap, .wpforms-layout-column",delay:200,cancel:!1,scroll:!1,opacity:1,appendTo:"#wpforms-panel-fields",zindex:1e4,helper(){var e=w(this),r=w('<div class="wpforms-field-drag-out wpforms-field-drag">');return b.fieldType=e.data("field-type"),r.html(e.html())},start(e,r){if(WPFormsUtils.triggerEvent(c.$builder,"wpformsFieldAddDragStart",[b.fieldType,r]).isDefaultPrevented())return!1},stop(e,r){if(WPFormsUtils.triggerEvent(c.$builder,"wpformsFieldAddDragStop",[b.fieldType,r]).isDefaultPrevented())return!1}})},revertMoveFieldToColumn(e){var r;void 0===e.data("field-id")?e.remove():(e=e.detach(),r=b.$sortableStart.find("> .wpforms-field").eq(b.startPosition),e.removeClass("wpforms-field-dragging").removeClass("wpforms-field-drag-over").attr("style",""),r.length?r.before(e):b.$sortableStart.append(e))}};return F={positionFieldInColumn(e,r,l){WPForms.Admin.Builder.FieldLayout&&WPForms.Admin.Builder.FieldLayout.positionFieldInColumn(e,r,l)},receiveFieldToColumn(e,r,l){WPForms.Admin.Builder.FieldLayout&&WPForms.Admin.Builder.FieldLayout.receiveFieldToColumn(e,r,l)},fieldOptionsUpdate(e,r){WPForms.Admin.Builder.FieldLayout&&WPForms.Admin.Builder.FieldLayout.fieldOptionsUpdate(e,r)},reorderLayoutFieldsOptions(e){WPForms.Admin.Builder.FieldLayout&&WPForms.Admin.Builder.FieldLayout.reorderLayoutFieldsOptions(e)},isFieldAllowedInColum(e,r){var l;return!WPForms.Admin.Builder.FieldLayout||(l=WPForms.Admin.Builder.FieldLayout.isFieldAllowedInColum(e,r),wp.hooks.applyFilters("wpforms.LayoutField.isFieldAllowedDragInColumn",l,e,r))},isLayoutBasedField(e){return!!WPForms.Admin.Builder.FieldLayout&&WPForms.Admin.Builder.FieldLayout.isLayoutBasedField(e)}},v})(document,window,jQuery),WPForms.Admin.Builder.DragFields.init();