var WPForms=window.WPForms||{};WPForms.Admin=WPForms.Admin||{},WPForms.Admin.Builder=WPForms.Admin.Builder||{},WPForms.Admin.Builder.FieldMap=WPForms.Admin.Builder.FieldMap||((e,a)=>{let s={},t={init(){a(t.ready)},ready(){t.setup(),t.initUndoRedo(),t.events()},setup(){s.$builder=a("#wpforms-builder")},events(){s.$builder.on("input",".wpforms-field-map-table .key-source",function(){var e=a(this).val(),i=a(this).parent().parent().find(".key-destination"),d=i.data("name");e&&i.attr("name",d.replace("{source}",e.replace(/[^0-9a-zA-Z_-]/gi,"")))}),s.$builder.on("click",".wpforms-field-map-table .remove",function(e){e.preventDefault(),t.fieldMapTableDeleteRow(e,a(this))}),s.$builder.on("click",".wpforms-field-map-table .add",function(e){e.preventDefault(),t.fieldMapTableAddRow(e,a(this))}),s.$builder.on("wpformsSettingsBlockAdded wpformsSettingsBlockCloned",function(e,i){t.initUndoRedo(i)}),s.$builder.on("connectionRendered",function(e,i,d){d=d.connection?.id??d.id??d??"",d=a(`.wpforms-builder-provider-connection[data-connection_id="${d}"]`);t.initUndoRedo(d)}),s.$builder.on("wpformsBuilderProviderConnectionAjaxAlways",function(e,i){a(`.wpforms-builder-provider[data-provider="${i}"] .wpforms-builder-provider-connection`).each(function(){t.initUndoRedo(a(this))})}),a(e).on("wpformsFieldUpdate",t.fieldMapSelect)},initUndoRedo(e=null){(e=e??s.$builder).find(".wpforms-field-map-table, .wpforms-builder-provider-connection-fields-table").addClass("wpforms-undo-redo-container")},fieldMapTableDeleteRow(e,i){var i=a(i),d=i.closest("tr"),i=i.closest("table"),t=d.closest(".wpforms-builder-settings-block");"1"<i.find("tr").length&&(d.remove(),s.$builder.trigger("wpformsFieldMapTableDeletedRow",[t]))},fieldMapTableAddRow(e,i){let d=a(i),t=d.closest("tr"),l=t.closest(".wpforms-builder-settings-block"),o=t.clone(),r=WPForms.Admin.Builder.UndoRedoHelpers;o.find("input, select").each(function(){var e=a(this);e.attr("data-undo-redo-element-key",null).attr("value","").val(""),e.attr("data-undo-redo-element-key",r?.getElementKey(e)??"")}),o.find("select :selected").prop("selected",!1),o.find(".key-destination").attr("name",""),o.insertAfter(t),s.$builder.trigger("wpformsFieldMapTableAddedRow",[l,o])},fieldMapSelect(){WPFormsUtils.triggerEvent(s.$builder,"wpformsBeforeFieldMapSelectUpdate").isDefaultPrevented()||a(".wpforms-field-map-select").each(function(){var e=a(this);let i=e.data("field-map-placeholder"),d=(void 0!==i&&i||(i=wpforms_builder.select_field),e.data("field-map-allowed"));if(void 0!==d&&d){d=d.split(" "),d=!(0<=a.inArray("all-fields",d))&&d;var t,l=Boolean(e.data("field-map-allow-repeated-fields")),o=e.val(),r=wpf.getFields(d,!0,l);if(e.empty(),e.append(a("<option>",{value:"",text:i})),r&&!a.isEmptyObject(r))for(var n in r)r[n]?.id&&(n=r[n],t=wpf.sanitizeHTML(n?.label?.toString().trim()||wpforms_builder.field+" #"+n.id),e.append(a("<option>",{value:n.id,text:t})));l=e.data("custom-value-support");"boolean"==typeof l&&l&&e.append(a("<option>",{value:"custom_value",text:wpforms_builder.add_custom_value_label,class:"wpforms-field-map-option-custom-value"})),o&&e.val(o),s.$builder.trigger("wpformsFieldSelectMapped",[e])}})}};return t})(document,(window,jQuery)),WPForms.Admin.Builder.FieldMap.init();