export default function(e,l,r){let o={el:{},mouse:{},init(){o.setup(),o.el.$builder.on("wpformsBuilderReady",o.ready)},ready(){o.el=WPFormsBuilder.getElementsCache()?.elements??{},o.events()},setup(){o.el.$builder=r("#wpforms-builder")},events(){o.el.$builder.on("wpformsFieldTabToggleBefore",o.handleFieldTabToggleBefore),o.el.$builder.on("contextmenu",".wpforms-field",o.clearMultiSelections),o.el.$document.on("mousemove",e=>{o.mouse.x=e.pageX,o.mouse.y=e.pageY})},handleFieldTabToggleBefore(e,l,t,i){t?t.ctrlKey||t.metaKey||t.shiftKey?(o.handleMultiSelectLogic(l,t),i(!1)):(o.clearMultiSelections(),i(!0)):i(!0)},handleMultiSelectLogic(e,l){var t=r("#wpforms-field-"+e),i=o.isContainerField(t),s=o.getSelectedFields();0<s.length&&(i||o.hasContainerFields(s))?o.containerFieldTooltip.show(t):i||(l.shiftKey?o.shift.onClick(e,t):o.handleMultiSelect(e,t))},handleMultiSelect(e,l){var t;o.hasContainerFields()?o.clearMultiSelections():((t=o.getActiveField()).length&&t.data("field-id")!==e&&t.addClass("selected"),l.hasClass("selected")?o.unselectField(l):l.addClass("selected").addClass("active"),o.el.$builder.trigger("wpformsFieldMultiSelect",[e,l,o.getSelectedFields().length]))},unselectField(e){e.removeClass("selected");e=o.getSelectedFields();1===e.length&&r("#wpforms-field-"+e[0]).addClass("active").removeClass("selected")},isContainerField(e){return e.hasClass("wpforms-field-repeater")||e.hasClass("wpforms-field-layout")},hasContainerFields(e=null){var l;for(l of e||o.getSelectedFields()){var t=r("#wpforms-field-"+l);if(o.isContainerField(t))return!0}return!1},isUnselectedFirst(e){var l=o.el.$builder.find(".wpforms-field.selected").first();return!(l.hasClass("first-selected")&&l.data("field-id")===e)},clearMultiSelections(){o.el.$builder.find(".wpforms-field.selected").removeClass("selected"),o.el.$builder.trigger("wpformsFieldMultiSelectClear")},getSelectedFields(){let l=[];return o.el.$builder.find(".wpforms-field.selected, .wpforms-field.active").each(function(){var e=r(this).data("field-id");e&&l.push(e)}),l},getActiveField(){return o.el.$builder.find(".wpforms-field.active")},isDuplicationAllowed(e,l=null){let t=e instanceof jQuery?e:r("#wpforms-field-"+e);return!(t=!t.length&&l?o.el.$builder.find(`.wpforms-field[data-field-type="${l}"]`):t).length||t.find(".wpforms-field-duplicate").length},shift:{findRangeStartField(){var e=o.getSelectedFields();return 0<e.length?e[e.length-1]:(e=o.el.$builder.find(".wpforms-field.active")).length?e.data("field-id"):null},getAllFieldIds(){var e=o.el.$builder.find(".wpforms-field");let l=[];return e.each(function(){var e=r(this).data("field-id");e&&l.push(e)}),l},selectSingleField(e,l){l.addClass("selected").addClass("active"),o.el.$builder.trigger("wpformsFieldMultiSelect",[e,l,o.getSelectedFields().length])},selectFieldsInRange(l,t,i){for(let e=t;e<=i;e++){var s=l[e];r("#wpforms-field-"+s).addClass("selected").addClass("active")}},onClick(e,l){var t,i,s,d=this.findRangeStartField();!d||!r("#wpforms-field-"+d).length||(d=(t=this.getAllFieldIds()).indexOf(d),s=t.indexOf(e),-1===d)||-1===s||(i=Math.min(d,s),d=Math.max(d,s),s=t.slice(i,d+1),o.hasContainerFields(s))?this.selectSingleField(e,l):(this.selectFieldsInRange(t,i,d),o.el.$builder.trigger("wpformsFieldMultiSelect",[e,l,o.getSelectedFields().length]))}},containerFieldTooltip:{show(e){this.close();let l;try{l=e.tooltipster("instance")}catch(e){l=null}l||(this.init(e),l=e.tooltipster("instance")),e.tooltipster("open"),l._$tooltip.css({height:"auto",transform:"translateX(-50%)"}),l._$tooltip.find(".tooltipster-arrow").css({left:"50%"}),setTimeout(()=>{this.close()},3e3)},init(e){let l="";var t={content:l=e.hasClass("wpforms-field-repeater")?wpforms_builder.multi_select.repeater_tooltip??"":e.hasClass("wpforms-field-layout")?wpforms_builder.multi_select.layout_tooltip??"":wpforms_builder.multi_select.general_tooltip??"",trigger:"manual",interactive:!1,animationDuration:200,delay:0,side:["top"],contentAsHTML:!0,theme:["tooltipster-noir"],functionPosition:(e,l,t)=>(t.coord.top=o.mouse.y-42,t.coord.left=o.mouse.x+2,t)};e.tooltipster(t)},close(){o.el.$builder.find(".wpforms-field").each(function(){var e=r(this);if(e.hasClass("tooltipstered"))try{e.tooltipster("close")}catch(e){}})}}};return o}