export default function(e,n,d){class t extends WPForms.Admin.Builder.UndoRedoInputCommandBase.get(){static id="DateTimeChangeCommand";constructor(e,n,t){super(e,n,t),this.flatpickr=this.$input?.prop("_flatpickr")}applyValue(e){i.preventRecordingCommand=!0,this.flatpickr=this.getElement()?.prop("_flatpickr"),this.flatpickr&&this.flatpickr.setDate(e,!0),i.preventRecordingCommand=!1}getElement(e=this.$input){var e=super.getElement(e),n=e.prev('[type="hidden"].flatpickr-input');return n.length?n:e}}let i={el:{},sel:{flatpickrHiddenInput:'[type="hidden"].flatpickr-input',flatpickrInput:'[type="hidden"].flatpickr-input + input',timepickerInput:".ui-timepicker-input",clearButton:".wpforms-clear-datetime-field"},undoManager:null,init(){i.setup(),i.el.$builder.on("wpformsBuilderReady",_.debounce(i.ready,250))},setup(){i.el.$document=d(e),i.el.$builder=d("#wpforms-builder")},ready(){try{i.UndoRedo=WPForms.Admin.Builder.UndoRedo,i.UndoRedoHelpers=WPForms.Admin.Builder.UndoRedoHelpers,i.undoManager=i.UndoRedo.undoManager,i.el={...i.el,...i.UndoRedo.el}}catch(e){return void wpf.debug("UndoRedoDateTimePickers: Dependency modules are not available.")}i.UndoRedo.registerCommand(t),i.events()},events(){i.el.$document.on("focusin",i.sel.flatpickrInput,i.onDatePickerFocus).on("mousedown",i.sel.clearButton,i.onClearButtonMouseDown),i.el.$builder.on("wpformsUndoRedoRun",i.onUndoRedoRun)},onDatePickerFocus(e){e=d(e.target).prev(i.sel.flatpickrHiddenInput);i.initFlatpickrTracking(e)},onClearButtonMouseDown(e){var e=d(e.currentTarget),n=e.prevAll(i.sel.flatpickrHiddenInput),e=e.prevAll(i.sel.timepickerInput);i.initFlatpickrTracking(n),i.initTimepickerTracking(e)},onUndoRedoRun(e,n,t){var r;t.$input?.is(i.sel.timepickerInput)&&(r=t.$input.nextAll(i.sel.clearButton)).length&&("undo"===n&&""===t.oldValue||"redo"===n&&""===t.newValue)&&r.hide()},initFlatpickrTracking(e){var n,t;e.length&&(n=i.UndoRedoHelpers.getElementKey(e),"flatpickr"!==(t=i.UndoRedo.trackedInputs.get(n)??{}).type)&&(t.type="flatpickr",t.value=e.val(),t.instance=e.prop("_flatpickr"),t.instance.config.onChange.push(i.onDatePickerChange),i.UndoRedo.trackedInputs.set(n,t))},initTimepickerTracking(e){var n;e.length&&(n=i.UndoRedoHelpers.getElementKey(e),i.UndoRedo.trackedInputs.get(n)||i.UndoRedo.trackedInputs.set(n,e.val()))},onDatePickerChange(e,n,t){i.recordFlatpickrCommand(n,t)},recordFlatpickrCommand(e,n){var t,r,o;i.preventRecordingCommand||(n=d(n.input),t=i.UndoRedoHelpers.getElementKey(n),o=(r=i.UndoRedo.trackedInputs.get(t))?.value,r.value=e,i.UndoRedoHelpers.areValuesEqual(o,e))||(n=i.UndoRedo.getCommand("DateTimeChangeCommand",n,o,e),i.UndoRedo.record(n),i.UndoRedo.trackedInputs.set(t,r))}};return i}