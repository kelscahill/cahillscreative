export default function(o,e,i){let l={el:{},init(){l.setup(),l.el.$builder.on("wpformsBuilderReady",_.debounce(l.ready,250))},setup(){l.el.$document=i(o),l.el.$builder=i("#wpforms-builder")},ready(){try{l.UndoRedo=WPForms.Admin.Builder.UndoRedo,l.undoManager=l.UndoRedo.undoManager,l.UndoRedoInputSmartTags=WPForms.Admin.Builder.UndoRedoInputSmartTags,l.CopyPaste=WPForms.Admin.Builder.CopyPaste,l.WPFormsChoicesJS=WPForms.Admin.Builder.WPFormsChoicesJS,l.actionNameSeparator=l.UndoRedo.config.actionNameSeparator,l.el={...l.el,...l.UndoRedo.el}}catch(e){wpf.debug("UndoRedoHelpers: Dependency modules are not available.")}},mapToObject(e){var t,n,r={};for([t,n]of e)r[t]=n;return r},areValuesEqual(e,t){return e=e instanceof Map?l.mapToObject(e):e,t=t instanceof Map?l.mapToObject(t):t,JSON.stringify(e)===JSON.stringify(t)},isIgnoredElement(e){return e.is(".wpforms-undo-redo-ignore")||e.closest("#wpforms-panel-setup").length||e.closest(".jconfirm-content").length},isInFieldPreview(e){var t=!!e?.closest(".wpforms-field").length,e=!!e?.closest(".wpforms-field-option-row, .wpforms-field-options, .wpforms-panel-field").length;return t&&!e},getElementKey(e){var t=e?.data("undo-redo-element-key");if(!t?.length){var n=e?.attr("id");if(n?.length)return n;n=e?.attr("name");if(n?.length&&l.isNameAttrAllowed(n))return n;var n=e?.[0]?.tagName?.toLowerCase()??"el",r=Math.floor(999999*Math.random()),t=`${n}-${(new Date).getTime().toString(16)}-`+r.toString(16);e?.data("undo-redo-element-key",t).attr("data-undo-redo-element-key",t)}return t},isNameAttrAllowed(t){return!t?.match(/\[\]$/)?.length&&!!["[conditionals]","[choices]","[questions]","[columns]","[rows]","[fields_meta]","providers[","[entry_automation]"].find(e=>t?.includes(e))},getSectionTitle(e){if(!e)return"";var t=e.closest(".wpforms-field-option").find(".wpforms-field-option-field-title").text().trim();if(t?.length)return t;let n=e.closest(".wpforms-panel-content-section").find(".wpforms-panel-content-section-title");t=(n=n?.length?n:e.closest(".wpforms-add-fields-group").find(".wpforms-add-fields-heading")).clone();return t.find("i, div, span:not(:first-child), a, button").remove(),t.text().trim()},getInputLabelElements(e){if(!e)return"";var t=[".wpforms-larger-icon-choice",".wpforms-field-option-row",".wpforms-panel-field",".wpforms-builder-settings-block-header",".wpforms-builder-provider-connection-block"].join(", "),t=e.closest(t);let n=t.find("label").first();var r=e.attr("name")||"",o=t.closest(".wpforms-field-option-repeater").length,o=((r.includes("[preset]")||o&&r.includes("[display]"))&&(n=t.prev("label")),r.includes("[pdfs]")&&r.includes("_color]")&&(n=t.prev().find("label").first()),t.closest(".wpforms-field-map-table")),o=(o.length&&(n=o.find("h3, label").first()),t.find(".wpforms-builder-provider-connection-fields-table"));return o.length&&(e=e.parent().index(),n=o.find("thead tr").first().find("th").eq(e)),{$label:n,$inputContainer:t,inputName:r}},getInputLabel(e){if(!e)return"";var{$label:t,$inputContainer:n,inputName:r}=l.getInputLabelElements(e);let o="";n.hasClass("wpforms-builder-settings-block-header")&&(o=r.includes("name]")?wp.i18n.__("Settings block name","wpforms"):""),e.closest(".wpforms-pdf-theme-color-editor").length&&(o=wp.i18n.__("Theme color","wpforms")),e.closest(".wpforms-larger-icon-choice").length&&(o=t.text().trim());var n=e.closest(".wpforms-builder-provider-connection-fields"),t=((o=n.length&&e.is("table")?n.find("h4, label").first().text().trim():o)?.length||((n=t.clone()).find("i, div, span, a, button").remove(),o=n.text().trim()),r.includes("_color]")&&(o+=" "+wp.i18n.__("color","wpforms")),l.getInputSubLabel(e)),n=o?.length&&t?.length?l.actionNameSeparator:"";return[o,n,t].filter(Boolean).join(" ")},getInputSubLabel(e){if(e.is(".http-key-source"))return wp.i18n.__("Source","wpforms");if(e.is(".key-destination"))return wp.i18n.__("Destination","wpforms");if(l.UndoRedoInputSmartTags.getOriginalInput(e).is(".wpforms-field-map-custom-value"))return wp.i18n.__("Custom value","wpforms");var t=".sub-label, .sublabel, p.note";let n=e.next(t);return(n=(n=n.length?n:e.closest(".wpforms-image-control-group").find("label").first()).length?n:e.parent().nextAll(t).first()).is(".wpforms-notice-field-size")?"":n.text().trim()},getCLInputLabel(e){return e.closest(".wpforms-conditional-groups").length?(e=e.attr("name")??"").includes("[conditional_type]")?wp.i18n.__("Conditional Type","wpforms"):e.includes("[field]")?wp.i18n.__("Conditional Field","wpforms"):e.includes("[operator]")?wp.i18n.__("Conditional Operator","wpforms"):e.includes("[value]")?wp.i18n.__("Conditional Value","wpforms"):"":""},replaceDOMElement(e,t,n=!1){var r=l.getElement(e),e=l.getElementKey(e);n?r.html(t.html()):r.replaceWith(t),l.UndoRedo.trackedElements.set(e,t)},replaceDOMElementContent(e,t){l.replaceDOMElement(e,t,!0)},replaceElementAttributes(t,n){var e=t?.get(0),r=n?.get(0);e&&r&&(e=Array.from(e.attributes).map(e=>e.name),r=Array.from(r.attributes).map(e=>e.name),t.removeAttr(e.join(" ")),r.forEach(e=>{t.attr(e,n.attr(e))}))},getElement(e){var t,n=e,r=o.body.contains(n[0]);return n?.length&&r?n:(t=(r=e.attr("id"))&&!/[^a-zA-Z0-9-_]/.test(r)?i("#"+r):i(),r&&t.length?t:(r=e.attr("name"),t=i(`[name="${CSS.escape(r)}"]`),r?.length&&t.length&&l.isNameAttrAllowed(r)?t:(r=n?.data("undo-redo-element-key")||l.getElementKey(e),(t=i(`[data-undo-redo-element-key="${r}"]`)).length?t:(r=e.data("block-type"),t=e.data("block-id"),(r=i(`.wpforms-builder-settings-block[data-block-type="${r}"][data-block-id="${t}"]`)).length?r:(t=e.data("connection_id"),(r=i(`.wpforms-builder-provider-connection[data-connection_id="${t}"]`)).length?r:n)))))},cloneWithValues(e){var t=e.clone(!0,!0);let n=e.find("select");return t.find("select").each(function(e){var t=i(this),e=n.eq(e);t.val(e.val())}),t},convertInputValuesToAttributes(e){return e.length&&e[0].querySelectorAll("input, select, textarea").forEach(e=>{var t;"TEXTAREA"===e.tagName?e.textContent=e.value:"SELECT"===e.tagName?(t=i(e),l.CopyPaste?.updateFieldSelectElement(t,t.val())):"checkbox"!==e.type&&"radio"!==e.type?e.setAttribute("value",e.value):e.checked?e.setAttribute("checked","checked"):e.removeAttribute("checked")}),e},getCurrentContainer(e){var t=l.getElementKey(e);return e=l.prepareTrackedContainer(e),l.UndoRedo.trackedElements.set(t,e),e},getTrackedContainer(e){e=l.getElementKey(e);return l.UndoRedo.trackedElements.get(e)},setTrackedContainer(e,t){e=l.getElementKey(e);l.UndoRedo.trackedElements.set(e,t)},prepareTrackedContainer(e){e=l.cloneWithValues(e),e=l.CopyPaste?.replaceChoicesJSWithOriginalSelect(e)||e;return l.convertInputValuesToAttributes(e)},reInitTinyMCE(e){e=e.find(".wp-editor-wrap .mce-tinymce ~ textarea");e.length&&WPFormsBuilder.initElementsTinyMCE(e)},reInitChoicesJs(e){var t=["select.choicesjs-select","select.choices__input","select[data-choicesjs-key]"].join(", ");e.find(t).each(function(){l.WPFormsChoicesJS?.reinitFromRegistry(this)})}};return l}