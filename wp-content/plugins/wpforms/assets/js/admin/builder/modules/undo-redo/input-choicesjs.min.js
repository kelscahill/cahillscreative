export default function(e,o,r){let i={el:{},sel:{choicesSelect:"select.choices__input",choicesContainer:".choices"},undoManager:null,init(){i.setup(),i.el.$builder.on("wpformsBuilderReady",_.debounce(i.ready,250))},setup(){i.el.$document=r(e),i.el.$builder=r("#wpforms-builder")},ready(){try{i.UndoRedo=WPForms.Admin.Builder.UndoRedo,i.UndoRedoInputSimple=WPForms.Admin.Builder.UndoRedoInputSimple,i.UndoRedoHelpers=WPForms.Admin.Builder.UndoRedoHelpers,i.undoManager=i.UndoRedo.undoManager,i.WPFormsChoicesJS=WPForms.Admin.Builder.WPFormsChoicesJS,i.el={...i.el,...i.UndoRedo.el}}catch(e){return void wpf.debug("UndoRedoInputChoicesJS: Dependency modules are not available.")}i.events()},events(){i.el.$document.on("mousedown",i.sel.choicesContainer,i.onChoicesFocus).on("focusin",i.sel.choicesContainer,i.onChoicesFocus).on("addItem",i.sel.choicesSelect,i.onChoicesSelectChange).on("removeItem",i.sel.choicesSelect,i.onChoicesSelectChange)},getChoicesSelectFromContainer(e){return e.find(i.sel.choicesSelect).first()},onChoicesFocus(e){var o,e=r(e.currentTarget);i.UndoRedoHelpers.isInFieldPreview(e)||0!==(e=i.getChoicesSelectFromContainer(e))?.length&&(o=i.UndoRedoHelpers.getElementKey(e),e=i.getChoicesValue(e),i.UndoRedo.trackedInputs.set(o,e))},onChoicesSelectChange(e){var o,n,t,e=r(e.target);i.UndoRedoInputSimple.preventRecordingCommand||i.UndoRedo.isSuppressed()||i.UndoRedo.isRecordPrevented()||i.UndoRedoHelpers.isInFieldPreview(e)||(t=i.UndoRedoHelpers.getElementKey(e),o=i.UndoRedo.trackedInputs.get(t),n=i.getChoicesValue(e),i.UndoRedo.trackedInputs.set(t,n),i.UndoRedoHelpers.areValuesEqual(o,n))||(t=i.UndoRedo.getCommand("InputChangeCommand",e,o,n),i.UndoRedo.record(t))},applyChoicesMultipleValue(e,o,n){if(o?.length){var t,r=n.config.choices;for(t of o)if(t){let o="object"==typeof t?t.value:t;var i=r.find(e=>e.value===o);"object"!=typeof t||i||n.setChoices([...r,{value:t.value,label:t.label}],"value","label",!0,!1,!0),n.setChoiceByValue(String(o))}}else e.val([])},applyChoicesValue(e,o,n){i.UndoRedoInputSimple.preventRecordingCommand=!0;try{n.removeActiveItems(),Array.isArray(o)?i.applyChoicesMultipleValue(e,o,n):null!=o&&""!==o?n.setChoiceByValue(String(o)):e.val("")}finally{Promise.resolve().then(()=>{e.trigger("input").trigger("change"),i.UndoRedoInputSimple.preventRecordingCommand=!1})}},getChoicesInstance(e){var o=i.WPFormsChoicesJS?.getRegistryData(e);let n=e.data("choicesjs")||e.data("choices");return n=o?.instance&&!n?i.WPFormsChoicesJS?.reinitFromRegistry(e):n},getChoicesValue(e){var o=i.getChoicesInstance(e)?.getValue(),e=e.is(".wpforms-file-upload-user-roles-select");return o&&Array.isArray(o)?e?o.filter(e=>"administrator"!==e.value):o:o?.value??o??""}};return i}