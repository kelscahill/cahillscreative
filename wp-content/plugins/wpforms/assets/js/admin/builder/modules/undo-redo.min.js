export default function(e,n,o){let r={config:{actionNameSeparator:"→"},el:{},commandClasses:new Map,undoManager:null,trackedInputs:new Map,trackedElements:new Map,suppressCount:0,executeTriggerEvents:!0,preventRunCommand:!1,preventRecordingCommand:!1,init(){r.undoManager=new Oops({maxStackSize:100,mergeWindow:50,snapshotInterval:100,compressThreshold:500}),r.setup(),r.el.$builder.on("wpformsBuilderReady",_.debounce(r.ready,250))},setup(){r.el.$document=o(e),r.el.$builder=o("#wpforms-builder")},ready(){try{r.KeyboardShortcuts=WPForms.Admin.Builder.KeyboardShortcuts}catch(e){return void wpf.debug("UndoRedo: Dependency modules are not available.")}(WPFormsBuilder.UndoRedo=r).setupUI(),r.events(),wpf.debug("Undo/Redo initialized")},events(){r.undoManager.addChangeListener(r.updateUI),r.el.$builder.on("wpformsPanelSwitched",r.onPanelSwitched)},registerCommand(e){r.commandClasses.set(e.id??e.name,e)},getCommand(e,...n){var o=r.commandClasses.get(e);return o?new o(...n):(wpf.debug(`Undo/Redo Command "${e}" not found.`),null)},beginSuppress(){r.suppressCount++},endSuppress(){0<r.suppressCount&&r.suppressCount--},isSuppressed(){return 0<r.suppressCount},preventRun(e){r.preventRunCommand=Boolean(e),r.updateUI()},canRun(e="undo"){var n;return!(!r.undoManager||r.preventRunCommand||(n="undo"===(e="undo"===e?"undo":"redo")?r.undoManager.canUndo:r.undoManager.canRedo,e=r.getCurrentCommand(e),"function"==typeof n?!n.call(r.undoManager):!n)||!e)},canUndo(){return r.canRun("undo")},canRedo(){return r.canRun("redo")},execute(e,n=!0){r.beginSuppress(),r.undoManager.undoStack=r.undoManager.undoStack.filter(Boolean),r.undoManager.redoStack=r.undoManager.redoStack.filter(Boolean),r.executeTriggerEvents=Boolean(n);try{r.undoManager.execute(e,{undoable:!0,silent:!1})}finally{r.executeTriggerEvents=!0,Promise.resolve().then(()=>{r.endSuppress()})}},preventRecord(e){r.preventRecordingStack=r.preventRecordingStack??[],"continue"===e?(r.preventRecordingStack.pop(),r.preventRecordingCommand=Boolean(r.preventRecordingStack[r.preventRecordingStack.length-1])):e?(r.preventRecordingStack.push(e),r.preventRecordingCommand=!0):(r.preventRecordingStack=[],r.preventRecordingCommand=!1)},isRecordPrevented(){return r.preventRecordingCommand},record(e){r.preventRecordingCommand||(r.execute(e,!1),r.preventRecord("continue"),wpf.debug("Undo/Redo command recorded:",e.actionName??"",e))},getCurrentCommand(e="undo"){e="undo"===e?r.undoManager.undoStack:r.undoManager.redoStack;return e?.[e?.length-1]??null},run(n="undo"){if(n="undo"===n?"undo":"redo",r.canRun(n)){let e=r.getCurrentCommand(n);var o=e?.getActionName?.()||wp.i18n.__("Change","wpforms");try{r.undoManager[n]()}finally{Promise.resolve().then(()=>{r.endSuppress(),r.el.$builder.trigger("wpformsUndoRedoRun",[n,e])})}var d="undo"===n?wp.i18n.__("Undone","wpforms"):wp.i18n.__("Redone","wpforms");r.lastExecuted={commandType:n,command:e},r.showNotification([d+":",o].join(" "))}},revertRun(){r.lastExecuted&&r.run("undo"===r.lastExecuted.commandType?"redo":"undo")},undo(){r.run("undo")},redo(){r.run("redo")},setupUI(){var e,n=o(".wpforms-panel-revisions-button");0!==n.length&&((e=o(`<div class="wpforms-undo-redo wpforms-hidden">
					<button type="button" class="wpforms-btn-undo" disabled>
						<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path fill-rule="evenodd" fill="var( --button-path-color )" clip-rule="evenodd" d="M9.33594 5.62988L10.4365 6.62988L10.7998 6.96094L8.30469 9.7998H16.5C17.5092 9.7998 18.4368 10.1372 19.1406 10.834C20.0081 11.6437 20.4099 12.823 20.6045 13.9258C20.8006 15.0373 20.7998 16.1542 20.7998 16.9004V17.5996H18.2998V16.7998C18.2998 16.2472 18.2988 15.406 18.1797 14.584C18.059 13.7517 17.8307 13.0568 17.4648 12.6748C17.1241 12.4249 16.8371 12.2998 16.5 12.2998H8.50684L10.707 14.5L9 16.207L4.14648 11.3535L3.81055 11.0186L4.12793 10.665L8.62793 5.66504L8.96484 5.29199L9.33594 5.62988Z"/>
						</svg>
					</button>
					<button type="button" class="wpforms-btn-redo" disabled>
						<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path fill-rule="evenodd" fill="var( --button-path-color )" clip-rule="evenodd" d="M15.2744 5.62988L14.1738 6.62988L13.8105 6.96094L16.3057 9.7998H8.11035C7.10117 9.7998 6.17356 10.1372 5.46973 10.834C4.60221 11.6437 4.20046 12.823 4.00586 13.9258C3.80972 15.0373 3.81055 16.1542 3.81055 16.9004V17.5996H6.31055V16.7998C6.31055 16.2472 6.31153 15.406 6.43066 14.584C6.55131 13.7517 6.77967 13.0568 7.14551 12.6748C7.48627 12.4249 7.77328 12.2998 8.11035 12.2998H16.1035L13.9033 14.5L15.6104 16.207L20.4639 11.3535L20.7998 11.0186L20.4824 10.665L15.9824 5.66504L15.6455 5.29199L15.2744 5.62988Z"/>
						</svg>
					</button>
				</div>`)).find(".wpforms-btn-undo").attr("title",wp.i18n.__("Undo (Ctrl+Z)","wpforms")),e.find(".wpforms-btn-redo").attr("title",wp.i18n.__("Redo (Ctrl+Y)","wpforms")),n.before(e),r.el.$btnUndo=e.find(".wpforms-btn-undo"),r.el.$btnRedo=e.find(".wpforms-btn-redo"),r.el.$btnsUndoRedo=e,r.el.$btnUndo.on("click",r.undo),r.el.$btnRedo.on("click",r.redo))},updateUI(){var e;r.el.$btnsUndoRedo?.length&&(e=!r.canUndo()&&!r.canRedo()&&!r.preventRunCommand,r.el.$btnsUndoRedo.toggleClass("wpforms-hidden",e),r.updateButton("undo"),r.updateButton("redo"))},updateButton(e="undo"){e="undo"===e?"undo":"redo";var n=r.canRun(e);let o=r.getCurrentCommand(e)?.getActionName?.();o=o?(d=r.config.actionNameSeparator.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),d=new RegExp(String.raw`\s${d}$`),o.replace(d,"")):"";var d=r.KeyboardShortcuts.isMac()?"⌘":"Ctrl",d={undo:`(${d}+Z)`,redo:`(${d}+Shift+Z)`},d=[{undo:wp.i18n.__("Undo","wpforms"),redo:wp.i18n.__("Redo","wpforms")}[e],o,d[e]].filter(Boolean).join(" ");({undo:r.el.$btnUndo,redo:r.el.$btnRedo})[e].prop("disabled",!n).attr("title",d)},showNotification(e){wpf.debug(e)},onPanelSwitched(e,n){r.el.$btnsUndoRedo.toggleClass("wpforms-hidden","setup"===n)}};return r}