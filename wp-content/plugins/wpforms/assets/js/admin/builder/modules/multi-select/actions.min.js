export default function(e,l,a){let s={el:{},init(){s.setup(),s.el.$builder.on("wpformsBuilderReady",s.ready)},ready(){try{s.MultiSelect=WPForms.Admin.Builder.MultiSelect,s.FieldLayout=WPForms.Admin.Builder.FieldLayout,s.FieldRepeater=WPForms.Admin.Builder.FieldRepeater}catch(e){return void wpf.debug("MultiSelectActions: Dependency modules are not available.")}s.MultiSelect&&(s.el=WPFormsBuilder.getElementsCache()?.elements??{},s.events())},setup(){s.el.$builder=a("#wpforms-builder")},events(){s.el.$builder.on("click",'.wpforms-field-multi-field-menu .wpforms-context-menu-list-item[data-action="delete-multi"]',s.handleDeleteClick).on("click",'.wpforms-field-multi-field-menu .wpforms-context-menu-list-item[data-action="duplicate-multi"]',s.handleDuplicateClick).on("wpformsFieldMultiSelect",s.updateFirstSelectedClass).on("wpformsMultiFieldDuplicate",s.handleMultiFieldDuplicate).on("wpformsFieldMultiSelect",s.handleSidebarSwitch).on("wpformsFieldMultiSelectClear",s.handleSidebarSwitch)},handleDeleteClick(e){e.preventDefault(),e.stopPropagation();e=s.MultiSelect?.getSelectedFields();1<e.length&&s.multiFieldDelete(e)},handleDuplicateClick(e){e.preventDefault(),e.stopPropagation();e=s.MultiSelect?.getSelectedFields?.();1<e?.length&&s.multiFieldDuplicate(e)},multiFieldDelete(e){if(Array.isArray(e)&&0!==e.length){let i=[],t=[];e.forEach(e=>{var l=a("#wpforms-field-"+e);"pagebreak"===l.data("field-type")&&l.hasClass("wpforms-field-entry-preview-not-deleted")?t.push({id:e,reason:"pagebreak_entry_preview"}):l.hasClass("no-delete")?t.push({id:e,reason:"no_delete"}):i.push(e)}),t.forEach(e=>{"pagebreak_entry_preview"===e.reason?s.youCantRemovePageBreakFieldPopup():"no_delete"===e.reason&&s.youCantRemoveFieldPopup()}),0!==i.length&&s.confirmMultiFieldDeletion(i)}},showMultiFieldConfirmation(e){let{title:l,fieldIds:i,confirmText:t,eventName:r,actionCallback:o}=e;e=i.length,e=1===e?t:t.replace("%s",""+e),e={ids:i,message:e};WPFormsUtils.triggerEvent(s.el.$builder,r,[e]).isDefaultPrevented()||a.confirm({title:l,content:e.message,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",keys:["enter"],action(){o(i)}},cancel:{text:wpforms_builder.cancel}}})},confirmMultiFieldDeletion(e){s.showMultiFieldConfirmation({title:wpforms_builder.delete_confirm_multiple_title,fieldIds:e,confirmText:1===e.length?wpforms_builder.delete_confirm:wpforms_builder.delete_confirm_multiple,eventName:"wpformsBeforeMultiFieldDeleteAlert",actionCallback:s.multiFieldDeleteById})},multiFieldDeleteById(e){s.el.$builder.trigger("wpformsBeforeMultiFieldDelete",[e]),WPForms.Admin.Builder.UndoRedo?.preventRecord(!0),e.forEach(e=>{var l=a("#wpforms-field-"+e),i=a("#wpforms-field-option-"+e),t=l.data("field-type"),r=l.parents(".wpforms-field-layout-columns");s.el.$builder.trigger("wpformsBeforeFieldDelete",[e,t]),l.remove(),i.remove(),s.el.$builder.trigger("wpformsFieldDelete",[e,t,r])}),WPFormsBuilder?.fieldTabToggle("add-fields");var l=a(".wpforms-field-option"),i=s.el.$builder.find(".wpforms-field-submit");l.length<1&&(s.el.$sortableFieldsWrap.append(s.el.$noFieldsPreview.clone()),s.el.$fieldOptions.append(s.el.$noFieldsOptions.clone()),i.hide()),l.filter(":not(.wpforms-field-option-layout)").length||i.hide(),WPForms.Admin.Builder.UndoRedo?.preventRecord("continue"),s.el.$builder.trigger("wpformsMultiFieldDelete",[e])},showErrorPopup(e){var{title:e=wpforms_builder.heads_up,content:l,icon:i="fa fa-exclamation-circle",type:t="red",buttonText:r=wpforms_builder.ok}=e;a.alert({title:e,content:l,icon:i,type:t,buttons:{confirm:{text:r,btnClass:"btn-confirm",keys:["enter"]}}})},youCantRemovePageBreakFieldPopup(){s.showErrorPopup({content:wpforms_builder.entry_preview_require_page_break})},youCantRemoveFieldPopup(){s.showErrorPopup({content:wpforms_builder.you_cant_remove_field})},multiFieldDuplicate(e){if(Array.isArray(e)&&0!==e.length){let l=[],i=[];e.forEach(e=>{a("#wpforms-field-"+e).hasClass("no-duplicate")?i.push({id:e,reason:"no_duplicate"}):l.push(e)}),i.forEach(e=>{"no_duplicate"===e.reason&&s.youCantDuplicateFieldPopup()}),0!==l.length&&s.confirmMultiFieldDuplication(l)}},confirmMultiFieldDuplication(e){s.showMultiFieldConfirmation({title:1===e.length?wpforms_builder.duplicate_confirm_title:wpforms_builder.duplicate_confirm_multiple_title,fieldIds:e,confirmText:1===e.length?wpforms_builder.duplicate_confirm:wpforms_builder.duplicate_confirm_multiple.replaceAll("%s",e.length),eventName:"wpformsBeforeMultiFieldDuplicateAlert",actionCallback:s.multiFieldDuplicateById})},multiFieldDuplicateById(e){if(0===e.length)s.showErrorPopup({title:wpforms_builder.field_duplicate_error,content:wpforms_builder.field_duplicate_nested_error});else{let r=[],o=e[e.length-1];s.el.$builder.trigger("wpformsBeforeMultiFieldDuplicate",[e]),WPFormsBuilder.UndoRedo?.preventRecord(!0),e.forEach(e=>{var l,i,t;s.MultiSelect?.isDuplicationAllowed?.(e)&&(l=a("#wpforms-field-"+e),WPFormsUtils.triggerEvent(s.el.$builder,"wpformsBeforeFieldDuplicate",[e,l]).isDefaultPrevented()||(i=l.data("field-type"),i=s.getDuplicatePosition(o,i),i=WPFormsBuilder.fieldDuplicateRoutine?.(e,!0,i),r.push(i),o=i,s.handleFieldPositioning(e,i),t=a("#wpforms-field-"+i),WPFormsUtils.triggerEvent(s.el.$builder,"wpformsFieldDuplicated",[e,l,i,t])))}),WPFormsBuilder.increaseNextFieldIdAjaxRequest?.(),WPFormsBuilder.UndoRedo?.preventRecord(!1),s.el.$builder.trigger("wpformsMultiFieldDuplicate",[e,r])}},getDuplicatePosition(e=null,l=null){var i=s.MultiSelect?.getSelectedFields?.()??[];if(!(e=e??i[i.length-1]))return s.el.$builder.find(".wpforms-field-wrap > .wpforms-field:not(.wpforms-field-pagebreak)").last().data("field-id");i=a("#wpforms-field-"+e).closest(".wpforms-layout-column");if(!i.length)return e;var t=i.closest(".wpforms-field");let r=WPForms.Admin.Builder.FieldLayout?.isFieldAllowedInColumn(l,i);return(r="repeater"===t.data("field-type")?WPForms.Admin.Builder.FieldRepeater?.filterIsFieldAllowedDragInColumn(r,l,i):r)?e:t.data("field-id")},handleFieldPositioning(e,l){var e=a("#wpforms-field-"+e),i=a("#wpforms-field-"+l),l=(e.closest(".wpforms-layout-column").length&&s.FieldLayout?.positionFieldInColumn(l,i.index()-1,i.parent()),e.closest(".wpforms-field-repeater"));l.length&&s.FieldRepeater?.adjustRowsAppearance(l.data("field-id"))},youCantDuplicateFieldPopup(){s.showErrorPopup({title:wpforms_builder.field_locked,content:wpforms_builder.field_locked_no_duplicate_msg,icon:"fa fa-info-circle",type:"blue",buttonText:wpforms_builder.close})},updateFirstSelectedClass(){a(".wpforms-field.first-selected").removeClass("first-selected");var e=s.MultiSelect?.getSelectedFields();if(!(e.length<=1)){let r=null,o=Number.MAX_SAFE_INTEGER,d=-Number.MAX_SAFE_INTEGER,n=[];e.forEach(e=>{var l,i,t=a("#wpforms-field-"+e);t.length&&(l=(i=t.offset()).top,i=i.left+t.outerWidth(),(l<o||l===o&&i>d)&&(o=l,d=i,r=e),s.MultiSelect?.isDuplicationAllowed(e)||n.push(e))});var l=a("#wpforms-field-"+r);l.addClass("first-selected"),l.find('.wpforms-context-menu-list-item[data-action="duplicate-multi"]').toggleClass("wpforms-hidden",n.length===e.length)}},handleMultiFieldDuplicate(e,l,i){l.forEach(e=>{a("#wpforms-field-"+e).removeClass("active selected first-selected")}),i.forEach(e=>{a("#wpforms-field-"+e).removeClass("selected").css("margin-bottom","")}),s.MultiSelect?.clearMultiSelections()},handleSidebarSwitch(){var e=s.MultiSelect?.getSelectedFields();1<e.length?WPFormsBuilder?.fieldTabToggle("add-fields"):1===e.length&&WPFormsBuilder?.fieldTabToggle(e[0])}};return s}