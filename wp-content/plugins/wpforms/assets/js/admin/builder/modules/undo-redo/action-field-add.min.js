export default function(e,d,l){class o extends WPForms.Admin.Builder.UndoRedoActionCommandBase.get(){static id="ActionFieldAddCommand";constructor(e){super(e),this.actionName=this.getActionName()}execute(){r.UndoRedo.executeTriggerEvents&&this.addField(this.args)}undo(){r.UndoRedo.executeTriggerEvents&&this.deleteField(this.args)}addField(e){r.UndoRedo.preventRecord(!0),this.replaceDOMElementContent(r.el.$allFieldsPreview,e.new.$allFieldsPreview),this.replaceDOMElementContent(r.el.$allFieldsOptions,e.new.$allFieldsOptions);var d={...e.eventOptions,isUndoRedo:!0};r.el.$builder.trigger("wpformsFieldAdd",[e.fieldId,e.type,d,e.$fieldPreview,e.$fieldOptions]),r.UndoRedoHelpersFields.applyAddFieldsButtonAttributes(e.type,e.new.$addFieldsTab),r.UndoRedoHelpersFields.reInitFields(e.fieldId),r.UndoRedo.preventRecord(!1)}deleteField(e){r.UndoRedo.preventRecord(!0),this.replaceDOMElementContent(r.el.$allFieldsPreview,e.old.$allFieldsPreview),this.replaceDOMElementContent(r.el.$allFieldsOptions,e.old.$allFieldsOptions);var d=l("#wpforms-field-"+e.fieldId).parents(".wpforms-field-layout-columns");r.el.$builder.trigger("wpformsFieldDelete",[e.fieldId,e.type,d]),r.UndoRedoHelpersFields.applyAddFieldsButtonAttributes(e.type,e.old.$addFieldsTab),r.UndoRedoHelpersFields.reInitFields(),r.UndoRedo.preventRecord(!1)}getActionName(){var e,d;return this.actionName||(e=r.UndoRedoHelpersFields.getFieldName(this.args.type),d=`(#${this.args.fieldId})`,[wp.i18n.__("Add Field","wpforms"),r.actionNameSeparator,e,d].filter(Boolean).join(" "))}}let r={el:{},sel:{},undoManager:null,init(){r.setup(),r.el.$builder.on("wpformsBuilderReady",_.debounce(r.ready,250))},setup(){r.el.$document=l(e),r.el.$builder=l("#wpforms-builder"),r.el.$allFieldsPreview=r.el.$builder.find(".wpforms-field-wrap"),r.el.$allFieldsOptions=r.el.$builder.find(".wpforms-field-options")},ready(){try{r.UndoRedo=WPForms.Admin.Builder.UndoRedo,r.UndoRedoHelpers=WPForms.Admin.Builder.UndoRedoHelpers,r.UndoRedoHelpersFields=WPForms.Admin.Builder.UndoRedoHelpersFields,r.undoManager=r.UndoRedo.undoManager,r.actionNameSeparator=r.UndoRedo.config.actionNameSeparator,r.el={...r.el,...r.UndoRedo.el}}catch(e){return void wpf.debug("UndoRedoActionFieldAdd: Dependency modules are not available.")}r.UndoRedo.registerCommand(o),r.events()},events(){r.el.$builder.on("wpformsBeforeFieldAdd",r.onBeforeFieldAdd).on("wpformsFieldAddDragStart wpformsBeforeFieldAddOnClick",r.onBeforeFieldAddOnClick).on("wpformsFieldAdd",r.onFieldAdd)},onBeforeFieldAddOnClick(e,d){r.UndoRedo.isRecordPrevented()||("pagebreak"===d?r.originalPagebreakId="catch":(r.UndoRedoHelpersFields.getCurrentFieldsElements(),r.UndoRedoHelpersFields.getCurrentAddFieldsTab()))},onBeforeFieldAdd(e,d,l,o){r.UndoRedo.isRecordPrevented()||"pagebreak"===l&&["top","bottom"].includes(o.position)&&"catch"!==r.originalPagebreakId||"pagebreak"===l&&(r.originalPagebreakId=d,r.UndoRedoHelpersFields.getCurrentFieldsElements(),r.UndoRedoHelpersFields.getCurrentAddFieldsTab())},onFieldAdd(e,d,l,o,i,n){r.UndoRedo.isRecordPrevented()||o&&n.length&&i.length&&(o=o??{},"pagebreak"===l&&!r.UndoRedoHelpersFields.isTopBottomPagebreaksAdded()||(d="pagebreak"===l?r.originalPagebreakId:d,l=r.UndoRedo.getCommand("ActionFieldAddCommand",{fieldId:d,type:l,eventOptions:{...o},$fieldPreview:i.clone().css("margin-bottom",""),$fieldOptions:n.clone(),fieldSettings:wpf.getField(d),event:e.type??"",old:{...r.UndoRedoHelpersFields.getTrackedFieldsElements(),$addFieldsTab:r.UndoRedoHelpersFields.getTrackedAddFieldsTab()},new:{...r.UndoRedoHelpersFields.getCurrentFieldsElements(),$addFieldsTab:r.UndoRedoHelpersFields.getCurrentAddFieldsTab()}}),r.UndoRedo.record(l)))}};return r}