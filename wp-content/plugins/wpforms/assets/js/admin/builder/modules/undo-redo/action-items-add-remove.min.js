export default function(e,o,i){class n extends WPForms.Admin.Builder.UndoRedoActionCommandBase.get(){static id="ActionItemsAddRemoveCommand";constructor(e){super(e),this.actionName=this.getActionName()}execute(){r.UndoRedo.executeTriggerEvents&&this.updateContainer(this.args,"new")}undo(){r.UndoRedo.executeTriggerEvents&&this.updateContainer(this.args,"old")}updateContainer(o,n){if(o[n="new"===n?"new":"old"].$container?.length){r.UndoRedo.preventRecord(!0);let e;e=o.connectionId?(d=i(`.wpforms-builder-provider-connection[data-connection_id="${o.connectionId}"]`),t=o[n].$container.attr("class"),d.find(`[class="${t}"]`)):o[n].$container;var t,d=r.getContainer(e);this.replaceDOMElementContent(d,o[n].$container),r.reInitContainer(d),r.UndoRedo.preventRecord(!1)}}getActionName(){var e,o,n;return this.actionName||(e=(e={add:wp.i18n.__("Add item","wpforms"),remove:wp.i18n.__("Remove item","wpforms"),"ai-choices":wp.i18n.__("Add AI choices","wpforms"),"bulk-add":wp.i18n.__("Bulk add choices","wpforms"),"conditional-rule-add":wp.i18n.__("Add Conditional Logic Rule","wpforms"),"conditional-rule-delete":wp.i18n.__("Delete Conditional Logic Rule","wpforms"),"conditional-groups-add":wp.i18n.__("Add Conditional Logic Group","wpforms")})[this.args.source]??e[this.args.action],n=r.UndoRedoHelpers.getElement(this.args.new.$container),o=r.UndoRedoHelpers.getSectionTitle(n),n=r.UndoRedoHelpers.getInputLabel(n),[e,r.actionNameSeparator,o,r.actionNameSeparator,n].filter(Boolean).join(" "))}}let r={el:{},sel:{buttons:[".wpforms-undo-redo-container .add",".wpforms-undo-redo-container .remove",".wpforms-undo-redo-container .add button",".wpforms-undo-redo-container .delete button",".wpforms-undo-redo-container .wpforms-conditional-rule-add",".wpforms-undo-redo-container .wpforms-conditional-rule-delete",".wpforms-undo-redo-container .wpforms-conditional-groups-add"].join(","),bulkAddButton:".bulk-add-insert",insertAiChoicesButton:".wpforms-ai-chat-choices-insert",clRuleAddButton:".wpforms-conditional-rule-add",clRuleDeleteButton:".wpforms-conditional-rule-delete",clGroupsAddButton:".wpforms-conditional-groups-add",clGroupsContainer:".wpforms-conditional-groups",container:".wpforms-undo-redo-container"},undoManager:null,init(){r.setup(),r.el.$builder.on("wpformsBuilderReady",_.debounce(r.ready,250))},setup(){r.el.$document=i(e),r.el.$builder=i("#wpforms-builder")},ready(){try{r.UndoRedo=WPForms.Admin.Builder.UndoRedo,r.UndoRedoHelpers=WPForms.Admin.Builder.UndoRedoHelpers,r.actionNameSeparator=r.UndoRedo.config.actionNameSeparator,r.el={...r.el,...r.UndoRedo.el}}catch(e){return void wpf.debug("UndoRedoActionItemsAddRemove: Dependency modules are not available.")}r.UndoRedo.registerCommand(n),r.events()},events(){r.el.$document.on("mousedown",r.sel.insertAiChoicesButton,r.onMousedown),r.el.$builder.on("mousedown",r.sel.buttons,r.onMousedown).on("mousedown",r.sel.bulkAddButton,r.onMousedown).on("wpformsProviderConnectionFieldDeleted",r.onFieldMapFieldDeleted).on("click",r.sel.buttons,_.debounce(r.onClick,0)).on("wpformsFieldChoiceAdd",r.onFieldChoiceAdd)},onMousedown(o){if(!r.UndoRedo.isRecordPrevented()){r.$trackButton=i(o.currentTarget);let e=r.$trackButton;r.$trackButton.is(r.sel.bulkAddButton)?e=r.$trackButton.closest(".bulk-add-display").next(".choices-list"):r.$trackButton.is(r.sel.insertAiChoicesButton)&&(o=r.$trackButton.closest("wpforms-ai-chat").attr("field-id"),e=i(`ul.choices-list[data-field-id="${o}"]`)),r.$trackContainer=r.getContainer(e),r.$trackButton.is(r.sel.clRuleDeleteButton)&&1===r.$trackContainer.find(r.sel.clRuleDeleteButton).length?r.$trackContainer=null:r.UndoRedoHelpers.getCurrentContainer(r.$trackContainer)}},onFieldMapFieldDeleted(e,o,n){r.$trackButton=n.find(".js-wpforms-builder-provider-connection-fields-delete"),r.onClick(e,"field-map")},onClick(e,o){r.UndoRedo.isRecordPrevented()||r.$trackContainer?.length&&(o=r.UndoRedo.getCommand("ActionItemsAddRemoveCommand",{action:r.getAction(),$button:r.$trackButton.clone(!0),fieldId:r.$trackContainer.closest(".wpforms-field-option").data("field-id"),fieldType:r.$trackContainer.closest(".wpforms-field-option").find(".wpforms-field-option-hidden-type").val(),connectionId:r.$trackContainer.closest(".wpforms-builder-provider-connection").data("connection_id"),source:o,event:e.type??"",old:{$container:r.UndoRedoHelpers.getTrackedContainer(r.$trackContainer)},new:{$container:r.UndoRedoHelpers.getCurrentContainer(r.$trackContainer)}}),r.UndoRedo.record(o))},onFieldChoiceAdd(e){var o=arguments[arguments?.length-1];["bulk-add","ai-choices"].includes(o)&&r.onClick(e,o)},getContainer(e){return(e=r.UndoRedoHelpers.getElement(e)).is(".wpforms-undo-redo-container")?e:e.closest(".wpforms-undo-redo-container")},getAction(){var e=r.$trackButton.attr("class");return e.includes("conditional-rule")?e.includes("add")?"conditional-rule-add":"conditional-rule-delete":e.includes("conditional-groups-add")?"conditional-groups-add":e.includes("add")?"add":"remove"},reInitContainer(e){e.hasClass("choices-list")&&r.reInitChoicesList(e),WPForms.Admin.Builder.SmartTags.reinitWidgets(e)},reInitChoicesList(e){var o=e.data("field-id"),e=e.data("field-type");WPFormsBuilder.fieldChoiceUpdate(e,o)}};return r}