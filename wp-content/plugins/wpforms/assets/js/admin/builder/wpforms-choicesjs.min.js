var WPForms=window.WPForms||{};WPForms.Admin=WPForms.Admin||{},WPForms.Admin.Builder=WPForms.Admin.Builder||{},WPForms.Admin.Builder.WPFormsChoicesJS=WPForms.Admin.Builder.WPFormsChoicesJS||((r,t,c)=>{let i=new Map,n,o=!1,a={init(){a.initChoicesProxy()},initChoicesProxy(){var e;o||"function"!=typeof t.Proxy||"function"!=typeof t.Choices||(n=t.Choices,(e=new t.Proxy(n,{construct(e,t,n){var[r=null,o={}]=t,r=a.normalizeElement(r),i=r?a.cloneElement(r):null,o=a.cloneArgs(o),e=Reflect.construct(e,t,n),t=r||a.normalizeElement(e?.passedElement?.element)||null;return a.storeRegistryEntry(t,e,o,i),e}})).prototype=n.prototype,a.copyStaticProperties(e,n),t.Choices=e,o=!0)},copyStaticProperties(n,r){Object.getOwnPropertyNames(r).forEach(function(t){if("prototype"!==t){var e=Object.getOwnPropertyDescriptor(r,t);try{Object.defineProperty(n,t,e)}catch(e){n[t]=r[t]}}})},storeRegistryEntry(t,n,r,o){if(t&&n){n={element:t,instance:n,options:r||{},elementClone:o||a.cloneElement(t)};let e=t.getAttribute("data-choicesjs-key");e&&!i.has(e)||(e=(new Date).getTime().toString(16),t.setAttribute("data-choicesjs-key",e),n.element.setAttribute("data-choicesjs-key",e),n.elementClone.setAttribute("data-choicesjs-key",e)),n.key=e,i.set(e,n)}},getRegistryData(e){e=a.getRegistryEntry(e);return e?{key:e.key,element:a.cloneElement(e.elementClone)||null,options:a.cloneArgs(e.options),instance:e.instance,originalElement:e.element}:null},reinitFromRegistry(e){var t=a.getRegistryEntry(e);if(!t)return null;var e=a.normalizeElement(e);if(!e)return null;try{t.instance.destroy?.()}catch(e){}return e.closest(".choices")?.replaceWith(t.elementClone),e=r.querySelector(`[data-choicesjs-key="${e.getAttribute("data-choicesjs-key")}"]`)??r.querySelector("#"+e.getAttribute("id"))??r.querySelector(`[name="${e.getAttribute("name")}"]`),a.setup(e,a.cloneArgs(t.options))},getRegistryEntry(e){var t;return e&&(t=(e=a.normalizeElement(e))?.getAttribute("data-choicesjs-key"),e)&&i.has(t)?i.get(t):null},normalizeElement(e){if(!e)return null;if(e.jquery)return e[0]||null;if(t.Element&&e instanceof t.Element)return e;if("string"==typeof e)try{return r.querySelector(e)}catch(e){return null}return e.passedElement?.element&&t.Element&&e.passedElement.element instanceof t.Element?e.passedElement.element:null},cloneArgs(e){if("function"==typeof t.structuredClone)try{return t.structuredClone(e)}catch(e){}return c.extend(!0,{},e)},cloneElement(e){return e&&"function"==typeof e.cloneNode?e.cloneNode(!0):null},setup(e,t,n=null){let r=c(e),o=r.data("choicesjs");var i,l;o&&o.destroy(),r.hasClass("choices__input")&&(i=r.closest(".choices"),l=r.detach().removeClass("choices__input").data("choice",null).attr("data-choice",null),i.replaceWith(l),e=(r=i.prevObject)[0]),WPForms.Admin.Builder.UndoRedo?.preventRecord(!0),t.searchEnabled=!0,t.allowHTML=!1,t.searchChoices=t.searchChoices??null===n?.nonce,t.renderChoiceLimit=-1,t.noChoicesText=t.noChoicesText||wpforms_builder.no_pages_found,t.noResultsText=t.noResultsText||wpforms_builder.no_pages_found;let s=t.callbackOnInit??null;return t.callbackOnInit=function(){"function"==typeof s&&s.call(this),WPForms.Admin.Builder.UndoRedo?.preventRecord("continue")},o=new Choices(e,t),r.data("choicesjs",o),a.setupEvents(r,o,n),o},setupEvents(n,o,e){let t=o.containerOuter?.element||n.closest(".choices")[0];e?.nonce&&a.setupSearchEvents(n,o,e),o.passedElement.element.addEventListener("change",function(){var e,t,n=c(this);n.prop("multiple")&&(e=n.data("field-id"),n=n.data("field-name"),t=o.getValue().map(function(e){return e.value}),c(`#wpforms-field-${e}-${n}-select-multiple-options`).val(JSON.stringify(t)))}),t?.addEventListener("click",function(){c(this).hasClass("is-open")&&o.hideDropdown()}),c(r).on("wpformsFieldOptionGroupToggled",function(){wpf.showMoreButtonForChoices(t)}).on("wpformsBeforeFieldDuplicate",function(e,t){if(n.data("field-id")===t){let r=o.getValue(!0);n.data("choicesjs")?.destroy(),n.find("option").each(function(e,t){var n=c(t).val();r.includes(n)&&c(t).prop("selected",!0)})}}).on("wpformsFieldDuplicated",function(e,t){n.data("field-id")===t&&(WPForms.Admin.Builder.UndoRedo?.preventRecord(!0),n.data("choicesjs")?.init())})},setupSearchEvents(e,t,n){(t.input?.element||e.nextAll(".choices__input ")[0])?.addEventListener("keyup",function(e){8!==e.which&&46!==e.which||0<e.target.value.length||a.performSearch(t,"",n)}),t.passedElement?.element.addEventListener("search",_.debounce(function(e){0!==t.input.element.value.length&&a.performSearch(t,e.detail.value,n)},800))},performSearch(t,e,n){n.action&&n.nonce&&(a.displayLoading(t),a.ajaxSearch(n.action,e,n.nonce,t.getValue(!0)).done(function(e){t.setChoices(e.data,"value","label",!0)}))},displayLoading(e){e.setChoices([{value:"",label:wpforms_builder.loading+"...",disabled:!0}],"value","label",!0)},ajaxSearchPages(e,t,n){return console.warn("WPForms.Admin.Builder.WPFormsChoicesJS.ajaxSearchPages is deprecated. Use WPForms.Admin.Builder.WPFormsChoicesJS.ajaxSearch instead."),a.ajaxSearch(e,t,n)},ajaxSearch(e,t,n,r=[]){return c.get(wpforms_builder.ajax_url,{action:e,search:t,_wpnonce:n,exclude:r}).fail(function(e){console.error(e)})}};return a})(document,window,jQuery),WPForms.Admin.Builder.WPFormsChoicesJS.init();