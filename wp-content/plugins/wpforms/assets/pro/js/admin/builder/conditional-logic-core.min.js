var WPFormsConditionals=window.WPFormsConditionals||((r,f)=>{let i={arraySplitIntoChunks(e,o){return e.length?[e.slice(0,o)].concat(i.arraySplitIntoChunks(e.slice(o),o)):[]}},a={allFields:{},$ruleRows:{},conditionalFields:{},fieldsListTemplate:"",fieldValuesListTemplates:{},cacheAllFields(e){a.allFields=e},cacheRuleRows(e){a.$ruleRows=e||f(".wpforms-conditional-row")},setConditionalFields(){a.conditionalFields=a.removeUnsupportedFields()},removeUnsupportedFields(){let o=wpforms_builder.cl_fields_supported,i={...a.allFields};return i=wp.hooks.applyFilters("wpforms.ConditionalLogicCore.BeforeRemoveUnsupportedFields",i),Object.keys(i).forEach(e=>{o.includes(i[e].type)&&!i[e].dynamic_choices||delete i[e]}),i},setTemplates(){a.setFieldsListTemplate(),a.fieldValuesListTemplates={}},setFieldsListTemplate(){var o,i=f("<select>").append(f("<option>",{value:"",text:wpforms_builder.select_field}));for(o in a.conditionalFields){var t=a.conditionalFields[o];let e;e=void 0!==t.label&&""!==t.label.toString().trim()?wpf.sanitizeHTML(t.label.toString().trim()):wpforms_builder.field+" #"+t.id,i.append(f("<option>",{value:t.id,text:e,id:"option-"+t.id}))}a.fieldsListTemplate=i.html()},getFieldValuesListTemplate(e,o){if(a.fieldValuesListTemplates[o])return a.fieldValuesListTemplates[o];e=f("#wpforms-builder").triggerHandler("wpformsConditionalRuleRowValue",[{fieldSelected:o,fields:e}]);if("string"==typeof e)return a.fieldValuesListTemplates[o]=e;var i,t=wpf.orders.choices["field_"+o],l=f("<select>"),n=Object.values(wpf.getFields()).find(e=>e.id.toString()===o.toString());for(i in t){var r=t[i],d=(n.choices||{})[r]||{};d.other||(d=void 0!==d.label&&""!==d.label.toString().trim()?wpf.sanitizeHTML(d.label.toString().trim()):wpforms_builder.choice_empty_label_tpl.replace("{number}",r),l.append(f("<option>",{value:r,text:d,id:"choice-"+r})))}return a.fieldValuesListTemplates[o]=l.html()},updateConditionalRuleRows(){i.arraySplitIntoChunks(a.$ruleRows,20).map(function(o){return setTimeout(function(){for(let e=0;e<o.length;++e)a.updateConditionalRuleRow(o[e])},0),o})},updateConditionalRuleRow(e){var e=f(e),o=e.attr("data-field-id"),i=e.find(".wpforms-conditional-field"),t=i.val();i[0].innerHTML=a.fieldsListTemplate,i.find("#option-"+o).remove(),f("#wpforms-builder").trigger("wpformsConditionalRuleRowField",[e,i,o,t]),(t?(o=e.find(".wpforms-conditional-value"),i.find("#option-"+t).length?a.restorePreviousRuleRowSelection(e,i,t,o):a.removeRuleRow(e),i.find("option").removeAttr("id"),o):i).find("option").removeAttr("id")},fieldDeleteConfirmAlert(e){let o=wpforms_builder.conditionals_change+"<br>",i;f(".wpforms-conditional-field").each(function(){e.id!==Number(f(this).val())||e.choiceId&&e.choiceId!==Number(f(this).closest(".wpforms-conditional-row").find(".wpforms-conditional-value").val())||(o+=a.getChangedFieldNameForAlert(a.getReferenceName(this)),i=!0,e.trigger=!0)}),i&&(e.message="<strong>"+e.message+"</strong><br><br>"+o)},getReferenceName(e){var e=f(e),o=e.closest(".wpforms-builder-provider").data("provider-name");return o?wpforms_builder.cl_reference.replace("{integration}",o):e.closest(".wpforms-conditional-group").data("reference")},restorePreviousRuleRowSelection(e,o,i,t){o.find("#option-"+i).prop("selected",!0),t.length&&t.is("select")&&(o=t.val(),t[0].innerHTML=a.getFieldValuesListTemplate(a.conditionalFields,i),t.find("#choice-"+o).length)&&t.find("#choice-"+o).prop("selected",!0)},removeRuleRow(e){var o=e.closest(".wpforms-conditional-group");1===o.find("table >tbody >tr").length?1<e.closest(".wpforms-conditional-groups").find(".wpforms-conditional-group").length?o.remove():(e.find(".wpforms-conditional-value").remove(),e.find(".value").append("<select>")):e.remove()},getChangedFieldNameForAlert(e){var o;return wpf.isNumber(e)?(((o=wpf.formObject("#wpforms-field-options")).fields[e]||{}).label||"").length?"<br/>"+wpf.sanitizeHTML(o.fields[e].label)+" ("+wpforms_builder.field+" #"+e+")":"<br>"+wpforms_builder.field+" #"+e:"<br>"+e}},d={init(){f(WPFormsConditionals.ready)},ready(){WPFormsConditionals.bindUIActions()},getLayoutFieldsToExclude(e){e=e.parents(".wpforms-field-option").find(".wpforms-field-option-hidden-id").val();let o=wpf.formObject("#wpforms-field-options");e=e&&o?.fields?.[e]?o.fields[e]:[];let i={};return Object.values(e["columns-json"]??{}).forEach(e=>{Object.values(e?.fields??[]).forEach(e=>{o.fields[e]&&(i[e]=o.fields[e])})}),i},bindUIActions(){var e=f("#wpforms-builder");e.on("change",".wpforms-conditionals-enable-toggle input[type=checkbox]",function(e){WPFormsConditionals.conditionalToggle(this,e)}),e.on("click",".wpforms-field-option-group-conditionals",function(){var e,o=f(this);"layout"===o.parents(".wpforms-field-option").find(".wpforms-field-option-hidden-type").val()&&(e=o.find(".wpforms-conditional-block"),o=wpf.getFields(!1,!0,!1,d.getLayoutFieldsToExclude(o)),WPFormsConditionals.conditionalUpdateOptions(!1,o,e.find(".wpforms-conditional-row")))}),e.on("change",".wpforms-conditional-field",function(e){WPFormsConditionals.conditionalField(this,e)}),e.on("change",".wpforms-conditional-operator",function(e){WPFormsConditionals.conditionalOperator(this,e)}),e.on("click",".wpforms-conditional-rule-add",function(e){WPFormsConditionals.conditionalRuleAdd(this,e)}),e.on("click",".wpforms-conditional-rule-delete",function(e){WPFormsConditionals.conditionalRuleDelete(this,e)}),e.on("click",".wpforms-conditional-groups-add",function(e){WPFormsConditionals.conditionalGroupAdd(this,e)}),f(r).on("wpformsFieldUpdate",WPFormsConditionals.conditionalUpdateOptions),e.on("wpformsBeforeFieldDeleteAlert",function(e,o){a.fieldDeleteConfirmAlert(o)})},conditionalUpdateOptions(e,o,i){wpf.empty(o)||(a.cacheAllFields(o),a.cacheRuleRows(i),a.setConditionalFields(),a.setTemplates(),a.updateConditionalRuleRows())},conditionalToggle(e,o){o.preventDefault();let i=f(e),t=i.closest(".wpforms-conditional-block"),l=wp.template("wpforms-conditional-block"),n={fieldID:i.closest(".wpforms-field-option-row").data("field-id"),fieldName:i.data("name"),actions:i.data("actions"),actionDesc:i.data("action-desc"),reference:i.data("reference")};i.is(":checked")?(t.find(".wpforms-conditional-groups").length||t.append(l(n)),o=wpf.getFields(!1,!0,!1,d.getLayoutFieldsToExclude(i)),WPFormsConditionals.conditionalUpdateOptions(!1,o,t.find(".wpforms-conditional-row"))):f.confirm({title:!1,content:wpforms_builder.conditionals_disable,backgroundDismiss:!1,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",keys:["enter"],action(){t.find(".wpforms-conditional-groups").remove(),f(r).trigger("wpformsRemoveConditionalLogicRules",[i])}},cancel:{text:wpforms_builder.cancel,action(){i.prop("checked",!0),f("#wpforms-builder").trigger("wpformsDisableConditionalLogicCanceled",[i])}}}})},conditionalField(e,o){o.preventDefault();var o=f(e),e=o.parent().parent(),i=e.find(".wpforms-conditional-operator"),t=i.find("option:selected").val(),l=WPFormsConditionals.conditionalData(o),n=l.inputName+"["+l.groupID+"]["+l.ruleID+"][value]";let r;if(l.field)if("select"===l.field.type||"radio"===l.field.type||"checkbox"===l.field.type||"payment-multiple"===l.field.type||"payment-checkbox"===l.field.type||"payment-select"===l.field.type){(r=f("<select>").attr({name:n,class:"wpforms-conditional-value"})).append(f("<option>",{value:"",text:wpforms_builder.select_choice}));var d,a=l.field.choices?wpf.orders.choices["field_"+l.field.id]:[];for(d in a){var s=a[d],p=l.field.choices[s]||{},c=void 0!==p.label&&""!==p.label.toString().trim()?wpf.sanitizeHTML(p.label.toString().trim()):wpforms_builder.choice_empty_label_tpl.replace("{number}",s);p.other||r.append(f("<option>",{value:s,text:wpf.sanitizeHTML(c)}))}i.find("option").prop("disabled",!1),i.find("option:not([value='=='],[value='!='],[value='e'],[value='!e'])").prop("disabled",!0).prop("selected",!1)}else{let e="text";"rating"!==l.field.type&&"net_promoter_score"!==l.field.type&&"number-slider"!==l.field.type||(e="number"),r=f("<input>").attr({type:e,name:n,class:"wpforms-conditional-value"}),i.find("option").prop("disabled",!1)}else r=f("<select>");"e"!==t&&"!e"!==t||r.prop("disabled",!0),e.find(".value").empty().append(r),f("#wpforms-builder").trigger("wpformsConditionalRuleRowOperator",[o,e,i,l,r])},conditionalOperator(e,o){o.preventDefault();o=f(e),e=o.parent().parent().find(".wpforms-conditional-value"),o=o.find("option:selected").val();"e"===o||"!e"===o?(e.prop("disabled",!0),e.is("select")?e.find("option:selected").prop("selected",!1):e.val("")):e.prop("disabled",!1)},conditionalRuleAdd(e,o){o.preventDefault();var o=f(e).closest(".wpforms-conditional-group").find("tr").last(),e=o.clone(),i=e.find(".wpforms-conditional-field"),t=e.find(".wpforms-conditional-operator"),l=WPFormsConditionals.conditionalData(i),n=Number(l.ruleID)+1,l=l.inputName+"["+l.groupID+"]["+n+"]";e.find("option:selected").prop("selected",!1),e.find(".value").empty().append(f("<select>")),i.attr("name",l+"[field]").attr("data-ruleid",n),t.attr("name",l+"[operator]"),o.after(e)},conditionalRuleDelete(e,o){o.preventDefault();var o=f(e),e=o.closest(".wpforms-conditional-group"),i=e.find("table >tbody >tr");i&&1===i.length?1<o.closest(".wpforms-conditional-groups").find(".wpforms-conditional-group").length?e.remove():(i.find(".wpforms-conditional-operator").val("==").trigger("change"),i.find(".wpforms-conditional-value").val("").trigger("change"),i.find(".wpforms-conditional-field").val("").trigger("change")):o.parent().parent().remove()},conditionalGroupAdd(e,o){o.preventDefault();var o=f(e),e=o.parent().find(".wpforms-conditional-group").last().clone(),i=(e.find("tr").slice(1).remove(),e.find(".wpforms-conditional-field")),t=e.find(".wpforms-conditional-operator"),l=WPFormsConditionals.conditionalData(i),n=Number(l.groupID)+1,l=l.inputName+"["+n+"][0]";e.find("option:selected").prop("selected",!1),e.find(".value").empty().append(f("<select>")),i.attr("name",l+"[field]").attr("data-ruleid",0).attr("data-groupid",n),t.attr("name",l+"[operator]"),o.before(e)},conditionalData(e){e=f(e),e={fields:wpf.getFields(!1,!0),inputBase:e.closest(".wpforms-conditional-row").attr("data-input-name"),fieldID:e.closest(".wpforms-conditional-row").attr("data-field-id"),ruleID:e.attr("data-ruleid"),groupID:e.attr("data-groupid"),selectedID:e.find(":selected").val()};return e.inputName=e.inputBase+"[conditionals]",e.selectedID?.length?e.field=wpf.getField(e.selectedID):e.field=!1,e}};return d})(document,(window,jQuery));WPFormsConditionals.init();